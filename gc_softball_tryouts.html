<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GC Softball Tryouts 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .score-btn { transition: all 0.2s; }
        .score-btn:hover { transform: scale(1.05); }
        .score-btn.selected { ring: 2px; }
    </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-blue-50 min-h-screen p-4">
    <!-- Login Screen -->
    <div id="loginScreen" class="fixed inset-0 bg-gray-900 bg-opacity-95 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-2xl p-8 max-w-md w-full mx-4">
            <div class="text-center mb-6">
                <img src="GClogo.jpg" alt="Logo" class="h-20 w-20 object-contain mx-auto mb-4" />
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Softball Tryout Scorer</h1>
                <p class="text-gray-600">Select your account and enter password</p>
            </div>
            <div class="space-y-4">
                <select id="userSelect" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-lg">
                    <option value="">-- Select Coach --</option>
                    <option value="nick">Nick</option>
                    <option value="bob">Bob</option>
                    <option value="sophia">Sophia</option>
                    <option value="amy">Amy</option>
                    <option value="bill">Bill</option>
                    <option value="gabby">Gabby</option>
                    <option value="guest">Guest</option>
                </select>
                <input
                    type="password"
                    id="passwordInput"
                    placeholder="Enter password"
                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-lg"
                    onkeypress="if(event.key === 'Enter') checkLogin()"
                />
                <button onclick="checkLogin()" class="w-full px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold text-lg">
                    Login
                </button>
                <div id="loginError" class="text-red-600 text-center text-sm hidden">
                    Incorrect password or no coach selected.
                </div>
            </div>
        </div>
    </div>

    <!-- Main App Content -->
    <div class="max-w-5xl mx-auto hidden" id="appContent">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="flex flex-col gap-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <img src="GClogo.jpg" alt="Logo" class="h-16 w-16 object-contain" />
                        <div>
                            <h1 class="text-2xl font-bold text-gray-800">GC Softball Tryouts 2026</h1>
                            <p class="text-gray-600">Logged in as: <span id="currentUserDisplay" class="font-semibold text-green-600"></span></p>
                        </div>
                    </div>
                    <button onclick="logout()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
                        Logout
                    </button>
                </div>

                <!-- Quick Actions -->
                <div class="flex gap-2 flex-wrap justify-center border-t pt-4">
                    <button onclick="toggleSection('advancedOptions')" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                        ‚öôÔ∏è Options
                    </button>
                    <button onclick="toggleSection('scoringConfigSection')" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                        üìä Scoring Thresholds
                    </button>
                    <button onclick="uploadToSheets()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                        ‚¨ÜÔ∏è Sync to Sheets
                    </button>
                    <button onclick="downloadFromSheets()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        ‚¨áÔ∏è Download from Sheets
                    </button>
                    <button onclick="showUserGuideModal()" class="px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700">
                        üìñ User Guide
                    </button>
                </div>

                <!-- Advanced Options -->
                <div id="advancedOptions" class="hidden mt-4 pt-4 border-t border-gray-200">
                    <h3 class="text-lg font-semibold mb-4">Add Player</h3>
                    <div class="flex gap-3 flex-wrap mb-4">
                        <input type="text" id="playerName" placeholder="Player Name" class="flex-1 min-w-[200px] px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" />
                        <input type="text" id="playerNumber" placeholder="Jersey #" class="w-32 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" />
                        <button onclick="addPlayer()" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                            ‚ûï Add Player
                        </button>
                    </div>
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="exportData()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            ‚¨áÔ∏è Export CSV
                        </button>
                        <button onclick="showReportModal()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                            üìä Generate Reports
                        </button>
                        <button onclick="clearAllData()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                            üóëÔ∏è Clear All Data
                        </button>
                    </div>
                </div>

                <!-- Scoring Configuration Section -->
                <div id="scoringConfigSection" class="hidden mt-4 pt-4 border-t border-gray-200">
                    <h3 class="text-lg font-semibold mb-3">üìä Scoring Thresholds Configuration</h3>
                    <p class="text-sm text-gray-600 mb-4">Customize scoring thresholds for all timed drills. Lower times = higher scores (except Broad Jump where higher distance = higher scores).</p>

                    <!-- Speed Drills Configuration -->
                    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                        <h4 class="font-semibold text-md mb-3">‚ö° Baserunning Speed Drills (seconds)</h4>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- H‚Üí1B -->
                            <div class="bg-white p-3 rounded border">
                                <label class="text-sm font-medium mb-2 block">H‚Üí1B (seconds)</label>
                                <div class="grid grid-cols-5 gap-2 text-xs">
                                    <div>
                                        <div class="text-center font-semibold text-green-600 mb-1">5 pts</div>
                                        <input type="number" step="0.1" id="h1b_t5" class="px-2 py-1 border rounded w-full text-center" title="5 points if less than this value">
                                        <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">&lt; this</div>
                                    </div>
                                    <div>
                                        <div class="text-center font-semibold text-blue-600 mb-1">4 pts</div>
                                        <input type="number" step="0.1" id="h1b_t4" class="px-2 py-1 border rounded w-full text-center">
                                        <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">&lt; this</div>
                                    </div>
                                    <div>
                                        <div class="text-center font-semibold text-yellow-600 mb-1">3 pts</div>
                                        <input type="number" step="0.1" id="h1b_t3" class="px-2 py-1 border rounded w-full text-center">
                                        <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">&lt; this</div>
                                    </div>
                                    <div>
                                        <div class="text-center font-semibold text-orange-600 mb-1">2 pts</div>
                                        <input type="number" step="0.1" id="h1b_t2" class="px-2 py-1 border rounded w-full text-center">
                                        <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">&lt; this</div>
                                    </div>
                                    <div>
                                        <div class="text-center font-semibold text-red-600 mb-1">1 pt</div>
                                        <input type="number" step="0.1" id="h1b_t1" class="px-2 py-1 border rounded w-full text-center">
                                        <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">‚â• this</div>
                                    </div>
                                </div>
                            </div>

                            <!-- 2B‚ÜíH -->
                            <div class="bg-white p-3 rounded border">
                                <label class="text-sm font-medium mb-2 block">2B‚ÜíH (seconds)</label>
                                <div class="grid grid-cols-5 gap-2 text-xs">
                                    <div>
                                        <div class="text-center font-semibold text-green-600 mb-1">5 pts</div>
                                        <input type="number" step="0.1" id="2bh_t5" class="px-2 py-1 border rounded w-full text-center">
                                        <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">&lt; this</div>
                                    </div>
                                    <div>
                                        <div class="text-center font-semibold text-blue-600 mb-1">4 pts</div>
                                        <input type="number" step="0.1" id="2bh_t4" class="px-2 py-1 border rounded w-full text-center">
                                        <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">&lt; this</div>
                                    </div>
                                    <div>
                                        <div class="text-center font-semibold text-yellow-600 mb-1">3 pts</div>
                                        <input type="number" step="0.1" id="2bh_t3" class="px-2 py-1 border rounded w-full text-center">
                                        <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">&lt; this</div>
                                    </div>
                                    <div>
                                        <div class="text-center font-semibold text-orange-600 mb-1">2 pts</div>
                                        <input type="number" step="0.1" id="2bh_t2" class="px-2 py-1 border rounded w-full text-center">
                                        <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">&lt; this</div>
                                    </div>
                                    <div>
                                        <div class="text-center font-semibold text-red-600 mb-1">1 pt</div>
                                        <input type="number" step="0.1" id="2bh_t1" class="px-2 py-1 border rounded w-full text-center">
                                        <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">‚â• this</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Catching Drills Configuration -->
                    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                        <h4 class="font-semibold text-md mb-3 flex items-center gap-2">
                            <img src="catcher.jpg" alt="Catcher" class="w-5 h-5 object-contain"> Catching Drills (seconds)
                        </h4>

                        <div class="bg-white p-3 rounded border">
                            <label class="text-sm font-medium mb-2 block">Pop Time (seconds)</label>
                            <div class="grid grid-cols-5 gap-2 text-xs">
                                <div>
                                    <div class="text-center font-semibold text-green-600 mb-1">5 pts</div>
                                    <input type="number" step="0.01" id="poptime_t5" class="px-2 py-1 border rounded w-full text-center">
                                    <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">‚â§ this</div>
                                </div>
                                <div>
                                    <div class="text-center font-semibold text-blue-600 mb-1">4 pts</div>
                                    <input type="number" step="0.01" id="poptime_t4" class="px-2 py-1 border rounded w-full text-center">
                                    <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">‚â§ this</div>
                                </div>
                                <div>
                                    <div class="text-center font-semibold text-yellow-600 mb-1">3 pts</div>
                                    <input type="number" step="0.01" id="poptime_t3" class="px-2 py-1 border rounded w-full text-center">
                                    <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">‚â§ this</div>
                                </div>
                                <div>
                                    <div class="text-center font-semibold text-orange-600 mb-1">2 pts</div>
                                    <input type="number" step="0.01" id="poptime_t2" class="px-2 py-1 border rounded w-full text-center">
                                    <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">‚â§ this</div>
                                </div>
                                <div>
                                    <div class="text-center font-semibold text-red-600 mb-1">1 pt</div>
                                    <input type="number" step="0.01" id="poptime_t1" class="px-2 py-1 border rounded w-full text-center">
                                    <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">&gt; this</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Explosiveness Drills Configuration -->
                    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                        <h4 class="font-semibold text-md mb-3">üí• Explosiveness Drills</h4>

                        <div class="grid grid-cols-1 gap-4">
                            <!-- Pro Agility -->
                            <div class="bg-white p-3 rounded border">
                                <label class="text-sm font-medium mb-2 block">Pro Agility (seconds)</label>
                                <div class="grid grid-cols-5 gap-2 text-xs">
                                    <div>
                                        <div class="text-center font-semibold text-green-600 mb-1">5 pts</div>
                                        <input type="number" step="0.1" id="proagility_t5" class="px-2 py-1 border rounded w-full text-center">
                                        <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">&lt; this</div>
                                    </div>
                                    <div>
                                        <div class="text-center font-semibold text-blue-600 mb-1">4 pts</div>
                                        <input type="number" step="0.1" id="proagility_t4" class="px-2 py-1 border rounded w-full text-center">
                                        <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">‚â§ this</div>
                                    </div>
                                    <div>
                                        <div class="text-center font-semibold text-yellow-600 mb-1">3 pts</div>
                                        <input type="number" step="0.1" id="proagility_t3" class="px-2 py-1 border rounded w-full text-center">
                                        <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">‚â§ this</div>
                                    </div>
                                    <div>
                                        <div class="text-center font-semibold text-orange-600 mb-1">2 pts</div>
                                        <input type="number" step="0.1" id="proagility_t2" class="px-2 py-1 border rounded w-full text-center">
                                        <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">‚â§ this</div>
                                    </div>
                                    <div>
                                        <div class="text-center font-semibold text-red-600 mb-1">1 pt</div>
                                        <input type="number" step="0.1" id="proagility_t1" class="px-2 py-1 border rounded w-full text-center">
                                        <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">&gt; this</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Broad Jump - Feet and Inches -->
                            <div class="bg-white p-3 rounded border">
                                <label class="text-sm font-medium mb-2 block">Broad Jump (feet' inches") - Higher is better</label>
                                <div class="grid grid-cols-5 gap-2 text-xs">
                                    <div>
                                        <div class="text-center font-semibold text-red-600 mb-1">1 pt</div>
                                        <div class="flex gap-1">
                                            <input type="number" min="0" max="15" id="broadjump_t1_feet" class="px-1 py-1 border rounded w-1/2 text-center" placeholder="ft">
                                            <input type="number" min="0" max="11" id="broadjump_t1_inches" class="px-1 py-1 border rounded w-1/2 text-center" placeholder="in">
                                        </div>
                                        <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">&lt; this</div>
                                    </div>
                                    <div>
                                        <div class="text-center font-semibold text-orange-600 mb-1">2 pts</div>
                                        <div class="flex gap-1">
                                            <input type="number" min="0" max="15" id="broadjump_t2_feet" class="px-1 py-1 border rounded w-1/2 text-center" placeholder="ft">
                                            <input type="number" min="0" max="11" id="broadjump_t2_inches" class="px-1 py-1 border rounded w-1/2 text-center" placeholder="in">
                                        </div>
                                        <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">&lt; this</div>
                                    </div>
                                    <div>
                                        <div class="text-center font-semibold text-yellow-600 mb-1">3 pts</div>
                                        <div class="flex gap-1">
                                            <input type="number" min="0" max="15" id="broadjump_t3_feet" class="px-1 py-1 border rounded w-1/2 text-center" placeholder="ft">
                                            <input type="number" min="0" max="11" id="broadjump_t3_inches" class="px-1 py-1 border rounded w-1/2 text-center" placeholder="in">
                                        </div>
                                        <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">&lt; this</div>
                                    </div>
                                    <div>
                                        <div class="text-center font-semibold text-blue-600 mb-1">4 pts</div>
                                        <div class="flex gap-1">
                                            <input type="number" min="0" max="15" id="broadjump_t4_feet" class="px-1 py-1 border rounded w-1/2 text-center" placeholder="ft">
                                            <input type="number" min="0" max="11" id="broadjump_t4_inches" class="px-1 py-1 border rounded w-1/2 text-center" placeholder="in">
                                        </div>
                                        <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">&lt; this</div>
                                    </div>
                                    <div>
                                        <div class="text-center font-semibold text-green-600 mb-1">5 pts</div>
                                        <div class="flex gap-1">
                                            <input type="number" min="0" max="15" id="broadjump_t5_feet" class="px-1 py-1 border rounded w-1/2 text-center" placeholder="ft">
                                            <input type="number" min="0" max="11" id="broadjump_t5_inches" class="px-1 py-1 border rounded w-1/2 text-center" placeholder="in">
                                        </div>
                                        <div class="text-center text-gray-500 mt-1" style="font-size: 0.65em;">‚â• this</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex gap-2 justify-center">
                        <button onclick="loadScoringDefaults()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                            Reset to Defaults
                        </button>
                        <button onclick="saveScoringConfig()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                            üíæ Save Thresholds
                        </button>
                    </div>
                </div>
            </div>
            <div class="mt-3 text-sm text-green-600" id="saveStatus">üîÑ Auto-syncing with Google Sheets</div>
        </div>

        <!-- Category Navigation -->
        <div class="bg-white rounded-lg shadow-lg p-4 mb-6">
            <div class="flex gap-2 flex-wrap justify-center">
                <button onclick="selectCategory('catching')" id="cat-catching" class="category-btn px-4 py-2 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 font-medium flex items-center gap-1">
                    <img src="catcher.jpg" alt="Catcher" class="w-5 h-5 object-contain"> Catching
                </button>
                <button onclick="selectCategory('baserunning')" id="cat-baserunning" class="category-btn px-4 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 font-medium">
                    üèÉ Baserunning
                </button>
                <button onclick="selectCategory('intangibles')" id="cat-intangibles" class="category-btn px-4 py-2 bg-yellow-100 text-yellow-700 rounded-lg hover:bg-yellow-200 font-medium">
                    ‚≠ê Intangibles
                </button>
                <button onclick="selectCategory('pitching')" id="cat-pitching" class="category-btn px-4 py-2 bg-gray-100 text-gray-500 rounded-lg font-medium flex items-center gap-1" disabled title="Coming soon">
                    <img src="pitching.jpg" alt="Pitching" class="w-5 h-5 object-contain"> Pitching (Soon)
                </button>
                <button onclick="selectCategory('fielding')" id="cat-fielding" class="category-btn px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 font-medium flex items-center gap-1">
                    <img src="fielding.jpg" alt="Fielding" class="w-5 h-5 object-contain"> Fielding
                </button>
                <button onclick="selectCategory('throwing')" id="cat-throwing" class="category-btn px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 font-medium flex items-center gap-1">
                    <img src="softball fielding.JPG" alt="Throwing" class="w-5 h-5 object-contain"> Throwing
                </button>
                <button onclick="selectCategory('hitting')" id="cat-hitting" class="category-btn px-4 py-2 bg-gray-100 text-gray-500 rounded-lg font-medium flex items-center gap-1" disabled title="Coming soon">
                    <img src="hitting.jpg" alt="Hitting" class="w-5 h-5 object-contain"> Hitting (Soon)
                </button>
            </div>
        </div>

        <!-- Player Selection -->
        <div class="bg-white rounded-lg shadow-lg p-4 mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">Select Player</label>
            <select id="playerSelect" onchange="selectPlayer(this.value)" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg">
                <option value="">-- Select a player --</option>
            </select>
        </div>

        <!-- Scoring Area -->
        <div id="scoringArea" class="hidden">
            <!-- Dynamic content based on category -->
        </div>

        <!-- All Players View -->
        <div id="allPlayersView" class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">All Players</h2>
            <div id="playersList"></div>
        </div>
    </div>

    <!-- Report Modal -->
    <div id="reportModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 overflow-y-auto">
        <div class="min-h-screen px-4 py-8 flex items-start justify-center">
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col">
                <div class="p-4 border-b flex justify-between items-center bg-indigo-600 text-white">
                    <h2 class="text-xl font-semibold">üìä Player Summary Reports</h2>
                    <button onclick="closeReportModal()" class="text-white hover:text-gray-200 text-2xl">&times;</button>
                </div>
                <div class="p-4 border-b bg-gray-50">
                    <div class="flex gap-4 items-center flex-wrap">
                        <label class="font-medium">Select Player:</label>
                        <select id="reportPlayerSelect" onchange="generateReport()" class="px-4 py-2 border rounded-lg">
                            <option value="">-- Choose a player --</option>
                        </select>
                        <button onclick="generateAllReports()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                            Generate All Players Report
                        </button>
                        <button onclick="exportCurrentReport()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            üì• Export Report
                        </button>
                    </div>
                </div>
                <div id="reportContent" class="p-6 overflow-y-auto flex-1">
                    <p class="text-gray-500 text-center">Select a player to generate their summary report</p>
                </div>
            </div>
        </div>
    </div>

    <!-- User Guide Modal -->
    <div id="userGuideModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 overflow-y-auto">
        <div class="min-h-screen px-4 py-8 flex items-start justify-center">
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col">
                <div class="p-4 border-b flex justify-between items-center bg-amber-600 text-white">
                    <h2 class="text-xl font-semibold">üìñ Coach User Guide</h2>
                    <button onclick="closeUserGuideModal()" class="text-white hover:text-gray-200 text-2xl">&times;</button>
                </div>
                <div class="p-4 border-b bg-gray-50">
                    <div class="flex gap-4 items-center flex-wrap">
                        <button onclick="exportUserGuideHTML()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            üì• Export as HTML
                        </button>
                        <button onclick="printUserGuide()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                            üñ®Ô∏è Print Guide
                        </button>
                    </div>
                </div>
                <div id="userGuideContent" class="p-6 overflow-y-auto flex-1 prose max-w-none">
                    <!-- Guide content will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxkTRC_6ucRdv-PBiaNq4ybRGYzvUbhC0vBPJGrPf3xEHOmcs284Fij7TCRhUdvc6Z1/exec';
        const STORAGE_KEY = 'gc_softball_tryouts_2026';
        const APP_PASSWORD = 'nick2026';
        const VALID_USERS = ['nick', 'bob', 'sophia', 'amy', 'bill', 'gabby', 'guest'];

        // ============================================
        // STATE
        // ============================================
        let currentUser = null;
        let players = [];
        let selectedPlayerId = null;
        let selectedCategory = 'catching';
        let isSyncing = false;
        let autoUploadTimer = null;
        const AUTO_UPLOAD_DELAY = 1000; // 1 second delay before auto-sync

        // ============================================
        // SCORING THRESHOLDS
        // ============================================
        const SCORING_CONFIG_KEY = 'gc_softball_scoring_config';

        // Default scoring thresholds - can be configured in Scoring Thresholds section
        // Time-based drills: t5=5pts, t4=4pts, t3=3pts, t2=2pts, t1=1pt (lower time = higher score)
        // Broad jump: t1=1pt, t2=2pts, t3=3pts, t4=4pts, t5=5pts (higher distance = higher score)
        let scoringConfig = {
            // Speed metrics (lower is better) - t5 is fastest (5pts), t1 is slowest (1pt)
            h1b: { t5: 3.1, t4: 3.8, t3: 4.6, t2: 5.2, t1: 6.0 },
            '2bh': { t5: 5.75, t4: 6.25, t3: 7, t2: 8, t1: 9 },  // 2B to Home
            // Pop time (lower is better)
            poptime: { t5: 2.3, t4: 2.5, t3: 2.7, t2: 3.0, t1: 3.5 },
            // Pro Agility (lower is better)
            proagility: { t5: 4.3, t4: 4.6, t3: 5.0, t2: 5.5, t1: 6.0 },
            // Broad jump (higher is better) - stored as { feet, inches } for each threshold
            broadjump: {
                t1: { feet: 4, inches: 0 },   // < this = 1 pt
                t2: { feet: 4, inches: 0 },   // >= this = 2 pts
                t3: { feet: 5, inches: 0 },   // >= this = 3 pts
                t4: { feet: 6, inches: 0 },   // >= this = 4 pts
                t5: { feet: 7, inches: 0 }    // >= this = 5 pts
            }
        };

        // Get default scoring config
        function getDefaultScoringConfig() {
            return {
                h1b: { t5: 3.1, t4: 3.8, t3: 4.6, t2: 5.2, t1: 6.0 },
                '2bh': { t5: 5.75, t4: 6.25, t3: 7, t2: 8, t1: 9 },
                poptime: { t5: 2.3, t4: 2.5, t3: 2.7, t2: 3.0, t1: 3.5 },
                proagility: { t5: 4.3, t4: 4.6, t3: 5.0, t2: 5.5, t1: 6.0 },
                broadjump: {
                    t1: { feet: 4, inches: 0 },
                    t2: { feet: 4, inches: 0 },
                    t3: { feet: 5, inches: 0 },
                    t4: { feet: 6, inches: 0 },
                    t5: { feet: 7, inches: 0 }
                }
            };
        }

        // Load scoring configuration from localStorage
        function loadScoringConfig() {
            try {
                const saved = localStorage.getItem(SCORING_CONFIG_KEY);
                if (saved) {
                    scoringConfig = JSON.parse(saved);
                }
                populateScoringInputs();
            } catch (error) {
                console.error('Error loading scoring config:', error);
            }
        }

        // Save scoring configuration to localStorage
        function saveScoringConfig() {
            try {
                // Read all values from inputs for time-based drills
                const timeDrills = ['h1b', '2bh', 'poptime', 'proagility'];

                timeDrills.forEach(drill => {
                    const cfg = scoringConfig[drill];
                    ['t5', 't4', 't3', 't2', 't1'].forEach(threshold => {
                        const inputId = `${drill}_${threshold}`;
                        const input = document.getElementById(inputId);
                        if (input && input.value !== '') {
                            cfg[threshold] = parseFloat(input.value);
                        }
                    });
                });

                // Handle broad jump separately (feet and inches)
                ['t1', 't2', 't3', 't4', 't5'].forEach(threshold => {
                    const feetInput = document.getElementById(`broadjump_${threshold}_feet`);
                    const inchesInput = document.getElementById(`broadjump_${threshold}_inches`);
                    if (feetInput || inchesInput) {
                        scoringConfig.broadjump[threshold] = {
                            feet: feetInput && feetInput.value !== '' ? parseInt(feetInput.value) : 0,
                            inches: inchesInput && inchesInput.value !== '' ? parseInt(inchesInput.value) : 0
                        };
                    }
                });

                localStorage.setItem(SCORING_CONFIG_KEY, JSON.stringify(scoringConfig));
                showSaveStatus('‚úì Scoring thresholds saved');

                // Refresh the current view to show updated scores
                renderScoringArea();
                renderAllPlayers();
            } catch (error) {
                console.error('Error saving scoring config:', error);
                showSaveStatus('‚ö†Ô∏è Failed to save scoring config');
            }
        }

        // Reset scoring configuration to defaults
        function loadScoringDefaults() {
            scoringConfig = getDefaultScoringConfig();
            populateScoringInputs();
            saveScoringConfig();
            showSaveStatus('‚úì Reset to default thresholds');
        }

        // Populate input fields with current config values
        function populateScoringInputs() {
            // Populate time-based drills
            const timeDrills = ['h1b', '2bh', 'poptime', 'proagility'];
            timeDrills.forEach(drill => {
                const cfg = scoringConfig[drill];
                if (cfg) {
                    ['t5', 't4', 't3', 't2', 't1'].forEach(threshold => {
                        const input = document.getElementById(`${drill}_${threshold}`);
                        if (input && cfg[threshold] !== undefined) {
                            input.value = cfg[threshold];
                        }
                    });
                }
            });

            // Populate broad jump (feet and inches)
            const bjCfg = scoringConfig.broadjump;
            if (bjCfg) {
                ['t1', 't2', 't3', 't4', 't5'].forEach(threshold => {
                    const feetInput = document.getElementById(`broadjump_${threshold}_feet`);
                    const inchesInput = document.getElementById(`broadjump_${threshold}_inches`);
                    const val = bjCfg[threshold];
                    if (val) {
                        // Handle both old format (just a number) and new format ({ feet, inches })
                        if (typeof val === 'object') {
                            if (feetInput) feetInput.value = val.feet || 0;
                            if (inchesInput) inchesInput.value = val.inches || 0;
                        } else {
                            // Legacy format - convert number to feet/inches
                            if (feetInput) feetInput.value = Math.floor(val);
                            if (inchesInput) inchesInput.value = Math.round((val - Math.floor(val)) * 12);
                        }
                    }
                });
            }
        }

        // ============================================
        // LOGIN FUNCTIONS
        // ============================================
        function checkLogin() {
            const user = document.getElementById('userSelect').value;
            const password = document.getElementById('passwordInput').value;

            if (!user || !VALID_USERS.includes(user)) {
                showLoginError();
                return;
            }

            if (password !== APP_PASSWORD) {
                showLoginError();
                return;
            }

            currentUser = user;
            sessionStorage.setItem('gcSoftballUser', user);
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('appContent').classList.remove('hidden');
            document.getElementById('currentUserDisplay').textContent = user.charAt(0).toUpperCase() + user.slice(1);

            initApp();
        }

        function showLoginError() {
            document.getElementById('loginError').classList.remove('hidden');
            document.getElementById('passwordInput').value = '';
        }

        function logout() {
            sessionStorage.removeItem('gcSoftballUser');
            currentUser = null;
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('appContent').classList.add('hidden');
            document.getElementById('loginError').classList.add('hidden');
            document.getElementById('passwordInput').value = '';
            document.getElementById('userSelect').value = '';
        }

        function checkSession() {
            const savedUser = sessionStorage.getItem('gcSoftballUser');
            if (savedUser && VALID_USERS.includes(savedUser)) {
                currentUser = savedUser;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('appContent').classList.remove('hidden');
                document.getElementById('currentUserDisplay').textContent = savedUser.charAt(0).toUpperCase() + savedUser.slice(1);
                initApp();
            }
        }

        // ============================================
        // APP INITIALIZATION
        // ============================================
        function initApp() {
            loadData();
            loadScoringConfig();
            autoDownloadFromSheets().then(() => {
                renderPlayerSelect();
                renderAllPlayers();
            });
        }

        function loadData() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    players = JSON.parse(saved);
                }
            } catch (e) {
                console.error('Error loading data:', e);
                players = [];
            }
        }

        function saveData() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(players));
                showSaveStatus('‚úì Saved locally');
                scheduleAutoUpload();
            } catch (e) {
                console.error('Error saving data:', e);
            }
        }

        function scheduleAutoUpload() {
            if (autoUploadTimer) clearTimeout(autoUploadTimer);
            autoUploadTimer = setTimeout(() => {
                autoUploadToSheets();
            }, AUTO_UPLOAD_DELAY);
        }

        // ============================================
        // PLAYER MANAGEMENT
        // ============================================
        function addPlayer() {
            const nameInput = document.getElementById('playerName');
            const numberInput = document.getElementById('playerNumber');
            const name = nameInput.value.trim();

            if (!name) {
                alert('Please enter a player name');
                return;
            }

            const newPlayer = {
                id: Date.now(),
                name: name,
                number: numberInput.value.trim(),
                catching: createCatchingData(),
                baserunning: createBaserunningData(),
                intangibles: createIntangiblesData(),
                notes: ''
            };

            players.push(newPlayer);
            saveData();
            renderPlayerSelect();
            renderAllPlayers();

            nameInput.value = '';
            numberInput.value = '';

            // Auto-select the new player
            selectedPlayerId = newPlayer.id;
            document.getElementById('playerSelect').value = newPlayer.id;
            renderScoringArea();
        }

        function createCatchingData() {
            return {
                poptime: [null, null],
                throwaccuracy: [null, null, null],
                blocking: null,
                footwork: null,
                mobility: null,
                explosiveness_throwing: null,
                explosiveness_bunts: null,
                notes: []  // Array of { coach: string, text: string, timestamp: string }
            };
        }

        function createBaserunningData() {
            return {
                // Speed metrics
                h1b: { times: [null, null], missed1b: [false, false] },
                '2bh': { times: [null, null], missed3b: [false, false] },
                // Explosiveness
                proagility: [null, null],
                broadjump: [{ feet: null, inches: null }, { feet: null, inches: null }],
                // Scrimmage scores (by coach)
                scrimmage: {},
                notes: []  // Array of { coach: string, text: string, timestamp: string }
            };
        }

        function createIntangiblesData() {
            return {
                notes: []  // Array of { coach: string, text: string, timestamp: string }
            };
        }

        function createFieldingData() {
            return {
                // Ground Balls drill (2 attempts, each with 5 scoring categories)
                groundballs: [
                    { footwork: null, technique: null, moveintothrow: null, strongthrow: null, intangibles: null },
                    { footwork: null, technique: null, moveintothrow: null, strongthrow: null, intangibles: null }
                ],
                // Fly Ball drill (5 scoring categories)
                flyball: { footwork: null, technique: null, moveintothrow: null, strongthrow: null, intangibles: null },
                notes: []
            };
        }

        function createThrowingData() {
            return {
                // Throwing Velocity (single value in mph)
                velocity: null,
                // Fly Ball Tagup Throw drill (5 scoring categories)
                flyballtagup: { footwork: null, technique: null, moveintothrow: null, strongthrow: null, intangibles: null },
                notes: []
            };
        }

        function deletePlayer(id) {
            if (!confirm('Are you sure you want to delete this player?')) return;
            players = players.filter(p => p.id !== id);
            if (selectedPlayerId === id) {
                selectedPlayerId = null;
                document.getElementById('playerSelect').value = '';
            }
            saveData();
            renderPlayerSelect();
            renderAllPlayers();
            renderScoringArea();
        }

        // ============================================
        // UI RENDERING
        // ============================================
        function renderPlayerSelect() {
            const select = document.getElementById('playerSelect');
            const currentValue = select.value;
            select.innerHTML = '<option value="">-- Select a player --</option>';

            const sortedPlayers = [...players].sort((a, b) => a.name.localeCompare(b.name));
            sortedPlayers.forEach(p => {
                const opt = document.createElement('option');
                opt.value = p.id;
                opt.textContent = p.number ? `${p.name} (#${p.number})` : p.name;
                select.appendChild(opt);
            });

            if (currentValue) select.value = currentValue;
        }

        function selectPlayer(playerId) {
            selectedPlayerId = playerId ? parseInt(playerId) : null;
            renderScoringArea();
        }

        function selectCategory(category) {
            selectedCategory = category;

            // Update button styles
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-offset-2', 'ring-green-500');
            });
            const activeBtn = document.getElementById(`cat-${category}`);
            if (activeBtn) {
                activeBtn.classList.add('ring-2', 'ring-offset-2', 'ring-green-500');
            }

            renderScoringArea();
        }

        function renderScoringArea() {
            const area = document.getElementById('scoringArea');

            if (!selectedPlayerId) {
                area.classList.add('hidden');
                return;
            }

            const player = players.find(p => p.id === selectedPlayerId);
            if (!player) {
                area.classList.add('hidden');
                return;
            }

            area.classList.remove('hidden');

            // Initialize player data structures if missing
            let needsSave = false;
            if (!player.catching) { player.catching = createCatchingData(); needsSave = true; }
            if (!player.baserunning) { player.baserunning = createBaserunningData(); needsSave = true; }
            if (!player.intangibles) { player.intangibles = {}; needsSave = true; }
            if (!player.fielding) { player.fielding = createFieldingData(); needsSave = true; }
            if (!player.throwing) { player.throwing = createThrowingData(); needsSave = true; }
            if (needsSave) saveData();

            switch (selectedCategory) {
                case 'catching':
                    area.innerHTML = renderCatchingSection(player);
                    break;
                case 'baserunning':
                    area.innerHTML = renderBaserunningSection(player);
                    break;
                case 'intangibles':
                    area.innerHTML = renderIntangiblesSection(player);
                    break;
                case 'fielding':
                    area.innerHTML = renderFieldingSection(player);
                    break;
                case 'throwing':
                    area.innerHTML = renderThrowingSection(player);
                    break;
                default:
                    area.innerHTML = '<div class="bg-white rounded-lg shadow-lg p-6 text-center text-gray-500">This category is coming soon!</div>';
            }
        }

        // ============================================
        // CATCHING SECTION
        // ============================================
        function renderCatchingSection(player) {
            if (!player.catching) player.catching = createCatchingData();
            const c = player.catching;

            return `
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <h2 class="text-xl font-semibold mb-4 flex items-center gap-2"><img src="catcher.jpg" alt="Catcher" class="w-6 h-6 object-contain"> Catching - ${player.name}</h2>

                    <!-- Pop Time -->
                    <div class="mb-6 p-4 bg-purple-50 rounded-lg">
                        <h3 class="font-semibold mb-3">Pop Time (seconds)</h3>
                        <div class="grid grid-cols-2 gap-4">
                            ${[0, 1].map(i => `
                                <div>
                                    <label class="text-sm text-gray-600">Attempt ${i + 1}</label>
                                    <input type="number" step="0.01" value="${c.poptime[i] || ''}"
                                        onchange="updateCatching(${player.id}, 'poptime', ${i}, this.value)"
                                        class="w-full px-3 py-2 border rounded-lg" placeholder="e.g., 2.35">
                                </div>
                            `).join('')}
                        </div>
                        <div class="mt-2 text-sm text-gray-600">
                            Score: <span class="font-bold">${calculatePopTimeScore(c.poptime)}</span>/5
                            (Avg: ${getAverageTime(c.poptime) || 'N/A'}s)
                        </div>
                    </div>

                    <!-- Throwing Accuracy -->
                    <div class="mb-6 p-4 bg-purple-50 rounded-lg">
                        <h3 class="font-semibold mb-2">Throwing Accuracy</h3>
                        <p class="text-xs text-gray-500 mb-3">3=On target (air/1-hop), 2=Right (air/1-hop), 1=Left (air/1-hop), 0=Off mark</p>
                        <div class="grid grid-cols-3 gap-4">
                            ${[0, 1, 2].map(i => `
                                <div>
                                    <label class="text-sm text-gray-600">Attempt ${i + 1}</label>
                                    <select onchange="updateCatching(${player.id}, 'throwaccuracy', ${i}, this.value)"
                                        class="w-full px-3 py-2 border rounded-lg">
                                        <option value="">--</option>
                                        ${[3, 2, 1, 0].map(v => `<option value="${v}" ${c.throwaccuracy[i] == v ? 'selected' : ''}>${v}</option>`).join('')}
                                    </select>
                                </div>
                            `).join('')}
                        </div>
                        <div class="mt-2 text-sm text-gray-600">
                            Total: <span class="font-bold">${sumScores(c.throwaccuracy)}</span>/9
                        </div>
                    </div>

                    <!-- Other Catching Drills -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${renderCatchingDrill(player, 'blocking', 'Blocking', '3=Stays down, 2=Smothers ball, 1=Picks up quickly, 0=Doesn\'t block')}
                        ${renderCatchingDrill(player, 'footwork', 'Footwork', '3=Limits steps before throwing')}
                        ${renderCatchingDrill(player, 'mobility', 'Mobility', '3=Quick movement for plays')}
                        ${renderCatchingDrill(player, 'explosiveness_throwing', 'Explosiveness (Throwing)', '3=Drives towards target when throwing')}
                        ${renderCatchingDrill(player, 'explosiveness_bunts', 'Explosiveness (Bunts)', '3=Quick to retrieve bunts and throw to 1B')}
                    </div>

                    <div class="mt-4 p-3 bg-green-100 rounded-lg">
                        <strong>Catching Total:</strong> ${calculateCatchingTotal(player)}/30
                    </div>

                    <!-- Notes Section -->
                    ${renderNotesSection(player, 'catching')}
                </div>
            `;
        }

        function renderCatchingDrill(player, field, label, description) {
            if (!player.catching) player.catching = createCatchingData();
            const value = player.catching[field];
            return `
                <div class="p-4 bg-purple-50 rounded-lg">
                    <h3 class="font-semibold mb-1">${label}</h3>
                    <p class="text-xs text-gray-500 mb-2">${description}</p>
                    <div class="flex gap-2">
                        ${[0, 1, 2, 3].map(v => `
                            <button onclick="updateCatchingDrill(${player.id}, '${field}', ${v})"
                                class="score-btn flex-1 py-2 rounded-lg ${value == v ? 'bg-purple-600 text-white' : 'bg-white border hover:bg-purple-100'}">
                                ${v}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function updateCatching(playerId, field, index, value) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;
            if (!player.catching) player.catching = createCatchingData();

            const numVal = value === '' ? null : parseFloat(value);
            player.catching[field][index] = numVal;
            saveData();
            renderScoringArea();
        }

        function updateCatchingDrill(playerId, field, value) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;
            if (!player.catching) player.catching = createCatchingData();

            player.catching[field] = value;
            saveData();
            renderScoringArea();
        }

        // ============================================
        // BASERUNNING SECTION
        // ============================================
        function renderBaserunningSection(player) {
            if (!player.baserunning) player.baserunning = createBaserunningData();
            const b = player.baserunning;

            return `
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">üèÉ Baserunning - ${player.name}</h2>

                    <!-- Speed Metrics -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-3 text-blue-700">‚ö° Speed Metrics</h3>

                        <!-- H to 1B -->
                        <div class="mb-4 p-4 bg-blue-50 rounded-lg">
                            <h4 class="font-semibold mb-2">H ‚Üí 1B (2 attempts)</h4>
                            <div class="grid grid-cols-2 gap-4">
                                ${[0, 1].map(i => `
                                    <div>
                                        <label class="text-sm text-gray-600">Attempt ${i + 1}</label>
                                        <input type="number" step="0.01" value="${b.h1b.times[i] || ''}"
                                            onchange="updateSpeedTime(${player.id}, 'h1b', ${i}, this.value)"
                                            class="w-full px-3 py-2 border rounded-lg" placeholder="seconds">
                                        <label class="flex items-center gap-2 mt-1 text-sm">
                                            <input type="checkbox" ${b.h1b.missed1b[i] ? 'checked' : ''}
                                                onchange="updateSpeedCheckbox(${player.id}, 'h1b', 'missed1b', ${i}, this.checked)">
                                            Missed 1B (+0.5s)
                                        </label>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="mt-2 text-sm">
                                Adjusted Avg: <strong>${getAdjustedAvgH1B(b.h1b)}s</strong> |
                                Score: <strong>${calculateSpeedScore('h1b', getAdjustedAvgH1B(b.h1b))}</strong>/5
                            </div>
                        </div>

                        <!-- 2B to Home -->
                        <div class="mb-4 p-4 bg-blue-50 rounded-lg">
                            <h4 class="font-semibold mb-2">2B ‚Üí Home (2 attempts)</h4>
                            <div class="grid grid-cols-2 gap-4">
                                ${[0, 1].map(i => `
                                    <div>
                                        <label class="text-sm text-gray-600">Attempt ${i + 1}</label>
                                        <input type="number" step="0.01" value="${b['2bh'].times[i] || ''}"
                                            onchange="updateSpeedTime(${player.id}, '2bh', ${i}, this.value)"
                                            class="w-full px-3 py-2 border rounded-lg" placeholder="seconds">
                                        <label class="flex items-center gap-2 mt-1 text-sm">
                                            <input type="checkbox" ${b['2bh'].missed3b[i] ? 'checked' : ''}
                                                onchange="updateSpeedCheckbox(${player.id}, '2bh', 'missed3b', ${i}, this.checked)">
                                            Missed 3B (+1s)
                                        </label>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="mt-2 text-sm">
                                Adjusted Avg: <strong>${getAdjustedAvg2BH(b['2bh'])}s</strong> |
                                Score: <strong>${calculateSpeedScore('2bh', getAdjustedAvg2BH(b['2bh']))}</strong>/5
                            </div>
                        </div>

                    </div>

                    <!-- Explosiveness -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-3 text-orange-700">üí• Explosiveness</h3>

                        <!-- Pro Agility -->
                        <div class="mb-4 p-4 bg-orange-50 rounded-lg">
                            <h4 class="font-semibold mb-2">Pro Agility (2 attempts)</h4>
                            <p class="text-xs text-gray-500 mb-2">5: &lt;4.3s | 4: 4.3-4.6s | 3: 4.7-5.0s | 2: 5.1-5.5s | 1: &gt;5.5s</p>
                            <div class="grid grid-cols-2 gap-4">
                                ${[0, 1].map(i => `
                                    <div>
                                        <label class="text-sm text-gray-600">Attempt ${i + 1}</label>
                                        <input type="number" step="0.01" value="${b.proagility[i] || ''}"
                                            onchange="updateExplosiveness(${player.id}, 'proagility', ${i}, this.value)"
                                            class="w-full px-3 py-2 border rounded-lg" placeholder="seconds">
                                    </div>
                                `).join('')}
                            </div>
                            <div class="mt-2 text-sm">
                                Avg: <strong>${getAverageTime(b.proagility) || 'N/A'}s</strong> |
                                Score: <strong>${calculateProAgilityScore(b.proagility)}</strong>/5
                            </div>
                        </div>

                        <!-- Broad Jump -->
                        <div class="mb-4 p-4 bg-orange-50 rounded-lg">
                            <h4 class="font-semibold mb-2">Broad Jump (2 attempts)</h4>
                            <div class="grid grid-cols-2 gap-4">
                                ${[0, 1].map(i => {
                                    const jump = b.broadjump[i] || { feet: null, inches: null };
                                    return `
                                    <div>
                                        <label class="text-sm text-gray-600">Attempt ${i + 1}</label>
                                        <div class="flex gap-2">
                                            <input type="number" min="0" max="15" value="${jump.feet || ''}"
                                                onchange="updateBroadJump(${player.id}, ${i}, 'feet', this.value)"
                                                class="w-1/2 px-3 py-2 border rounded-lg" placeholder="ft">
                                            <input type="number" min="0" max="11" value="${jump.inches || ''}"
                                                onchange="updateBroadJump(${player.id}, ${i}, 'inches', this.value)"
                                                class="w-1/2 px-3 py-2 border rounded-lg" placeholder="in">
                                        </div>
                                    </div>
                                `}).join('')}
                            </div>
                            <div class="mt-2 text-sm">
                                Avg: <strong>${getAverageBroadJump(b.broadjump) || 'N/A'}</strong> |
                                Score: <strong>${calculateBroadJumpScore(b.broadjump)}</strong>/5
                            </div>
                        </div>
                    </div>

                    <!-- Scrimmage Scores -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-3 text-green-700">üìã Scrimmage Scores (Your Evaluation)</h3>
                        <p class="text-sm text-gray-500 mb-3">All coaches evaluate these - scores are averaged</p>

                        ${renderScrimmageScores(player)}
                    </div>

                    <div class="mt-4 p-3 bg-green-100 rounded-lg">
                        <strong>Baserunning Total:</strong> ${calculateBaserunningTotal(player)}/30
                    </div>

                    <!-- Notes Section -->
                    ${renderNotesSection(player, 'baserunning')}
                </div>
            `;
        }

        function renderScrimmageScores(player) {
            const scrimmage = player.baserunning?.scrimmage || {};
            const myScores = scrimmage[currentUser] || {};

            const drills = [
                { id: 'runningform', name: 'Running Form', max: 5 },
                { id: 'intangibles', name: 'Intangibles', max: 5 }
            ];

            return `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    ${drills.map(drill => `
                        <div class="p-3 bg-green-50 rounded-lg">
                            <h4 class="font-medium mb-2">${drill.name}</h4>
                            <div class="flex gap-2">
                                ${[1, 2, 3, 4, 5].map(v => `
                                    <button onclick="updateScrimmageScore(${player.id}, '${drill.id}', ${v})"
                                        class="score-btn flex-1 py-2 rounded-lg ${myScores[drill.id] == v ? 'bg-green-600 text-white' : 'bg-white border hover:bg-green-100'}">
                                        ${v}
                                    </button>
                                `).join('')}
                            </div>
                            <div class="text-xs text-gray-500 mt-1">
                                Avg: ${calculateAverageScore(scrimmage, drill.id).toFixed(1)} (${countCoachScores(scrimmage, drill.id)} coaches)
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // ============================================
        // INTANGIBLES SECTION
        // ============================================
        function renderIntangiblesSection(player) {
            if (!player.intangibles) player.intangibles = {};
            const intangibles = player.intangibles;
            const myScores = intangibles[currentUser] || {};

            const drills = [
                { id: 'awareness', name: 'Game Situation Awareness', description: 'Knows what to do on the basepath for various situations', max: 5 },
                { id: 'leadership', name: 'Leadership', description: 'Does the right things at the right time, keeps teammates on task, works hard during practice', max: 5 },
                { id: 'enthusiasm', name: 'Enthusiasm', description: 'Cheers for teammates, calls out where to throw the ball, moves quickly from drill to drill', max: 5 }
            ];

            return `
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">‚≠ê Intangibles - ${player.name}</h2>
                    <p class="text-sm text-gray-500 mb-4">All coaches evaluate these - scores are averaged</p>

                    <div class="space-y-4">
                        ${drills.map(drill => `
                            <div class="p-4 bg-yellow-50 rounded-lg">
                                <h3 class="font-semibold mb-1">${drill.name}</h3>
                                <p class="text-xs text-gray-500 mb-3">${drill.description}</p>
                                <div class="flex gap-2">
                                    ${[1, 2, 3, 4, 5].map(v => `
                                        <button onclick="updateIntangibleScore(${player.id}, '${drill.id}', ${v})"
                                            class="score-btn flex-1 py-3 rounded-lg text-lg font-semibold ${myScores[drill.id] == v ? 'bg-yellow-500 text-white' : 'bg-white border hover:bg-yellow-100'}">
                                            ${v}
                                        </button>
                                    `).join('')}
                                </div>
                                <div class="text-sm text-gray-600 mt-2">
                                    Your score: <strong>${myScores[drill.id] || 'Not set'}</strong> |
                                    Average: <strong>${calculateAverageScore(intangibles, drill.id).toFixed(1)}</strong>
                                    (${countCoachScores(intangibles, drill.id)} coaches)
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="mt-4 p-3 bg-green-100 rounded-lg">
                        <strong>Intangibles Average Total:</strong> ${calculateIntangiblesTotal(player).toFixed(1)}/15
                    </div>

                    <!-- Notes Section -->
                    ${renderNotesSection(player, 'intangibles')}
                </div>
            `;
        }

        // ============================================
        // FIELDING SECTION
        // ============================================
        function renderFieldingSection(player) {
            if (!player.fielding) player.fielding = createFieldingData();
            const f = player.fielding;

            const scoreCategories = [
                { id: 'footwork', name: 'Footwork' },
                { id: 'technique', name: 'Fielding Technique' },
                { id: 'moveintothrow', name: 'Move Into the Throw' },
                { id: 'strongthrow', name: 'Strong Accurate Throw' },
                { id: 'intangibles', name: 'Intangibles' }
            ];

            return `
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                        <img src="fielding.jpg" alt="Fielding" class="w-6 h-6 object-contain"> Fielding - ${player.name}
                    </h2>

                    <!-- Ground Balls (2 attempts) -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-3 text-green-700">Ground Balls (2 attempts)</h3>
                        ${[0, 1].map(attemptIdx => `
                            <div class="mb-4 p-4 bg-green-50 rounded-lg">
                                <h4 class="font-semibold mb-3">Attempt ${attemptIdx + 1}</h4>
                                <div class="grid grid-cols-1 md:grid-cols-5 gap-3">
                                    ${scoreCategories.map(cat => `
                                        <div class="p-2 bg-white rounded border">
                                            <label class="text-xs font-medium text-gray-600 block mb-1">${cat.name}</label>
                                            <div class="flex gap-1">
                                                ${[1, 2, 3, 4, 5].map(v => `
                                                    <button onclick="updateGroundBalls(${player.id}, ${attemptIdx}, '${cat.id}', ${v})"
                                                        class="flex-1 py-1 text-sm rounded ${f.groundballs[attemptIdx]?.[cat.id] == v ? 'bg-green-600 text-white' : 'bg-gray-100 hover:bg-green-100'}">
                                                        ${v}
                                                    </button>
                                                `).join('')}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                                <div class="mt-2 text-sm text-gray-600">
                                    Attempt ${attemptIdx + 1} Total: <strong>${calculateGroundBallAttemptTotal(f.groundballs[attemptIdx])}</strong>/25
                                </div>
                            </div>
                        `).join('')}
                        <div class="p-3 bg-green-100 rounded-lg">
                            <strong>Ground Balls Average:</strong> ${calculateGroundBallsAverage(f.groundballs).toFixed(1)}/25
                        </div>
                    </div>

                    <!-- Fly Ball -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-3 text-green-700">Fly Ball</h3>
                        <div class="p-4 bg-green-50 rounded-lg">
                            <div class="grid grid-cols-1 md:grid-cols-5 gap-3">
                                ${scoreCategories.map(cat => `
                                    <div class="p-2 bg-white rounded border">
                                        <label class="text-xs font-medium text-gray-600 block mb-1">${cat.name}</label>
                                        <div class="flex gap-1">
                                            ${[1, 2, 3, 4, 5].map(v => `
                                                <button onclick="updateFlyBall(${player.id}, '${cat.id}', ${v})"
                                                    class="flex-1 py-1 text-sm rounded ${f.flyball?.[cat.id] == v ? 'bg-green-600 text-white' : 'bg-gray-100 hover:bg-green-100'}">
                                                    ${v}
                                                </button>
                                            `).join('')}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="mt-2 text-sm text-gray-600">
                                Fly Ball Total: <strong>${calculateFlyBallTotal(f.flyball)}</strong>/25
                            </div>
                        </div>
                    </div>

                    <div class="mt-4 p-3 bg-green-100 rounded-lg">
                        <strong>Fielding Total:</strong> ${calculateFieldingTotal(player).toFixed(1)}/50
                    </div>

                    <!-- Notes Section -->
                    ${renderNotesSection(player, 'fielding')}
                </div>
            `;
        }

        // ============================================
        // THROWING SECTION
        // ============================================
        function renderThrowingSection(player) {
            if (!player.throwing) player.throwing = createThrowingData();
            const t = player.throwing;

            const scoreCategories = [
                { id: 'footwork', name: 'Footwork' },
                { id: 'technique', name: 'Fielding Technique' },
                { id: 'moveintothrow', name: 'Move Into the Throw' },
                { id: 'strongthrow', name: 'Strong Accurate Throw' },
                { id: 'intangibles', name: 'Intangibles' }
            ];

            return `
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                        <img src="softball fielding.JPG" alt="Throwing" class="w-6 h-6 object-contain"> Throwing - ${player.name}
                    </h2>

                    <!-- Throwing Velocity -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-3 text-red-700">Throwing Velocity</h3>
                        <div class="p-4 bg-red-50 rounded-lg">
                            <p class="text-xs text-gray-500 mb-2">5: 63+ | 4: 59-62 | 3: 53-58 | 2: 48-52 | 1: Under 48</p>
                            <div class="flex items-center gap-4">
                                <div class="flex-1">
                                    <label class="text-sm text-gray-600">Velocity (mph)</label>
                                    <input type="number" step="1" value="${t.velocity || ''}"
                                        onchange="updateThrowingVelocity(${player.id}, this.value)"
                                        class="w-full px-3 py-2 border rounded-lg" placeholder="e.g., 55">
                                </div>
                                <div class="text-center">
                                    <div class="text-sm text-gray-600">Score</div>
                                    <div class="text-2xl font-bold text-red-600">${calculateVelocityScore(t.velocity)}/5</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Fly Ball Tagup Throw -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-3 text-red-700">Fly Ball Tagup Throw</h3>
                        <div class="p-4 bg-red-50 rounded-lg">
                            <div class="grid grid-cols-1 md:grid-cols-5 gap-3">
                                ${scoreCategories.map(cat => `
                                    <div class="p-2 bg-white rounded border">
                                        <label class="text-xs font-medium text-gray-600 block mb-1">${cat.name}</label>
                                        <div class="flex gap-1">
                                            ${[1, 2, 3, 4, 5].map(v => `
                                                <button onclick="updateFlyBallTagup(${player.id}, '${cat.id}', ${v})"
                                                    class="flex-1 py-1 text-sm rounded ${t.flyballtagup?.[cat.id] == v ? 'bg-red-600 text-white' : 'bg-gray-100 hover:bg-red-100'}">
                                                    ${v}
                                                </button>
                                            `).join('')}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="mt-2 text-sm text-gray-600">
                                Fly Ball Tagup Total: <strong>${calculateFlyBallTagupTotal(t.flyballtagup)}</strong>/25
                            </div>
                        </div>
                    </div>

                    <div class="mt-4 p-3 bg-red-100 rounded-lg">
                        <strong>Throwing Total:</strong> ${calculateThrowingTotal(player).toFixed(1)}/30
                    </div>

                    <!-- Notes Section -->
                    ${renderNotesSection(player, 'throwing')}
                </div>
            `;
        }

        // ============================================
        // NOTES SECTION
        // ============================================
        function renderNotesSection(player, category) {
            let notes = [];
            if (category === 'catching' && player.catching) {
                notes = player.catching.notes || [];
            } else if (category === 'baserunning' && player.baserunning) {
                notes = player.baserunning.notes || [];
            } else if (category === 'intangibles') {
                notes = player.intangibles?.notes || [];
            } else if (category === 'fielding' && player.fielding) {
                notes = player.fielding.notes || [];
            } else if (category === 'throwing' && player.throwing) {
                notes = player.throwing.notes || [];
            }

            const categoryColors = {
                catching: 'purple',
                baserunning: 'blue',
                intangibles: 'yellow',
                fielding: 'green',
                throwing: 'red'
            };
            const color = categoryColors[category] || 'gray';

            return `
                <div class="mt-6 p-4 bg-${color}-50 rounded-lg border border-${color}-200">
                    <h3 class="font-semibold mb-3 flex items-center gap-2">
                        üìù Coach Notes
                    </h3>

                    <!-- Existing Notes -->
                    <div class="space-y-2 mb-4 max-h-48 overflow-y-auto">
                        ${notes.length === 0 ?
                            '<p class="text-gray-500 text-sm italic">No notes yet</p>' :
                            notes.map((note, idx) => `
                                <div class="bg-white p-3 rounded-lg border text-sm">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-1">
                                            <span class="font-medium text-${color}-700">${note.coach}:</span>
                                            <span class="text-gray-700">${note.text}</span>
                                        </div>
                                        ${note.coach === currentUser ? `
                                            <button onclick="deleteNote(${player.id}, '${category}', ${idx})"
                                                class="text-red-500 hover:text-red-700 ml-2 text-xs">‚úï</button>
                                        ` : ''}
                                    </div>
                                    <div class="text-xs text-gray-400 mt-1">${note.timestamp}</div>
                                </div>
                            `).join('')
                        }
                    </div>

                    <!-- Add Note Form -->
                    <div class="flex gap-2">
                        <input type="text" id="note-${category}-${player.id}"
                            placeholder="Add a note..."
                            class="flex-1 px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-${color}-500"
                            onkeypress="if(event.key==='Enter') addNote(${player.id}, '${category}')">
                        <button onclick="addNote(${player.id}, '${category}')"
                            class="px-4 py-2 bg-${color}-600 text-white rounded-lg hover:bg-${color}-700 text-sm">
                            Add Note
                        </button>
                    </div>
                </div>
            `;
        }

        function addNote(playerId, category) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;

            const input = document.getElementById(`note-${category}-${playerId}`);
            const text = input.value.trim();
            if (!text) return;

            const note = {
                coach: currentUser,
                text: text,
                timestamp: new Date().toLocaleString()
            };

            // Initialize data structures if needed
            if (category === 'catching') {
                if (!player.catching) player.catching = createCatchingData();
                if (!player.catching.notes) player.catching.notes = [];
                player.catching.notes.push(note);
            } else if (category === 'baserunning') {
                if (!player.baserunning) player.baserunning = createBaserunningData();
                if (!player.baserunning.notes) player.baserunning.notes = [];
                player.baserunning.notes.push(note);
            } else if (category === 'intangibles') {
                if (!player.intangibles) player.intangibles = createIntangiblesData();
                if (!player.intangibles.notes) player.intangibles.notes = [];
                player.intangibles.notes.push(note);
            } else if (category === 'fielding') {
                if (!player.fielding) player.fielding = createFieldingData();
                if (!player.fielding.notes) player.fielding.notes = [];
                player.fielding.notes.push(note);
            } else if (category === 'throwing') {
                if (!player.throwing) player.throwing = createThrowingData();
                if (!player.throwing.notes) player.throwing.notes = [];
                player.throwing.notes.push(note);
            }

            input.value = '';
            saveData();
            renderScoringArea();
        }

        function deleteNote(playerId, category, noteIndex) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;

            let notes;
            if (category === 'catching' && player.catching) {
                notes = player.catching.notes;
            } else if (category === 'baserunning' && player.baserunning) {
                notes = player.baserunning.notes;
            } else if (category === 'intangibles' && player.intangibles) {
                notes = player.intangibles.notes;
            } else if (category === 'fielding' && player.fielding) {
                notes = player.fielding.notes;
            } else if (category === 'throwing' && player.throwing) {
                notes = player.throwing.notes;
            }

            if (notes && notes[noteIndex] && notes[noteIndex].coach === currentUser) {
                notes.splice(noteIndex, 1);
                saveData();
                renderScoringArea();
            }
        }

        // ============================================
        // UPDATE FUNCTIONS
        // ============================================
        function updateSpeedTime(playerId, drill, index, value) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;
            if (!player.baserunning) player.baserunning = createBaserunningData();

            player.baserunning[drill].times[index] = value === '' ? null : parseFloat(value);
            saveData();
            renderScoringArea();
        }

        function updateSpeedCheckbox(playerId, drill, field, index, checked) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;
            if (!player.baserunning) player.baserunning = createBaserunningData();

            player.baserunning[drill][field][index] = checked;
            saveData();
            renderScoringArea();
        }

        function updateExplosiveness(playerId, drill, index, value) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;
            if (!player.baserunning) player.baserunning = createBaserunningData();

            player.baserunning[drill][index] = value === '' ? null : parseFloat(value);
            saveData();
            renderScoringArea();
        }

        function updateBroadJump(playerId, index, field, value) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;
            if (!player.baserunning) player.baserunning = createBaserunningData();

            // Ensure broadjump array has proper structure
            if (!player.baserunning.broadjump || !Array.isArray(player.baserunning.broadjump)) {
                player.baserunning.broadjump = [{ feet: null, inches: null }, { feet: null, inches: null }];
            }
            if (!player.baserunning.broadjump[index] || typeof player.baserunning.broadjump[index] !== 'object') {
                player.baserunning.broadjump[index] = { feet: null, inches: null };
            }

            player.baserunning.broadjump[index][field] = value === '' ? null : parseInt(value);
            saveData();
            renderScoringArea();
        }

        function updateScrimmageScore(playerId, drillId, value) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;
            if (!player.baserunning) player.baserunning = createBaserunningData();
            if (!player.baserunning.scrimmage) player.baserunning.scrimmage = {};
            if (!player.baserunning.scrimmage[currentUser]) player.baserunning.scrimmage[currentUser] = {};

            player.baserunning.scrimmage[currentUser][drillId] = value;
            saveData();
            renderScoringArea();
        }

        function updateIntangibleScore(playerId, drillId, value) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;
            if (!player.intangibles) player.intangibles = {};
            if (!player.intangibles[currentUser]) player.intangibles[currentUser] = {};

            player.intangibles[currentUser][drillId] = value;
            saveData();
            renderScoringArea();
        }

        // ============================================
        // FIELDING UPDATE FUNCTIONS
        // ============================================
        function updateGroundBalls(playerId, attemptIdx, category, value) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;
            if (!player.fielding) player.fielding = createFieldingData();
            if (!player.fielding.groundballs) {
                player.fielding.groundballs = [
                    { footwork: null, technique: null, moveintothrow: null, strongthrow: null, intangibles: null },
                    { footwork: null, technique: null, moveintothrow: null, strongthrow: null, intangibles: null }
                ];
            }
            if (!player.fielding.groundballs[attemptIdx]) {
                player.fielding.groundballs[attemptIdx] = { footwork: null, technique: null, moveintothrow: null, strongthrow: null, intangibles: null };
            }
            player.fielding.groundballs[attemptIdx][category] = value;
            saveData();
            renderScoringArea();
        }

        function updateFlyBall(playerId, category, value) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;
            if (!player.fielding) player.fielding = createFieldingData();
            if (!player.fielding.flyball) {
                player.fielding.flyball = { footwork: null, technique: null, moveintothrow: null, strongthrow: null, intangibles: null };
            }
            player.fielding.flyball[category] = value;
            saveData();
            renderScoringArea();
        }

        // ============================================
        // THROWING UPDATE FUNCTIONS
        // ============================================
        function updateThrowingVelocity(playerId, value) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;
            if (!player.throwing) player.throwing = createThrowingData();
            player.throwing.velocity = value === '' ? null : parseFloat(value);
            saveData();
            renderScoringArea();
        }

        function updateFlyBallTagup(playerId, category, value) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;
            if (!player.throwing) player.throwing = createThrowingData();
            if (!player.throwing.flyballtagup) {
                player.throwing.flyballtagup = { footwork: null, technique: null, moveintothrow: null, strongthrow: null, intangibles: null };
            }
            player.throwing.flyballtagup[category] = value;
            saveData();
            renderScoringArea();
        }

        // ============================================
        // FIELDING & THROWING CALCULATION FUNCTIONS
        // ============================================
        function calculateGroundBallAttemptTotal(attempt) {
            if (!attempt) return 0;
            const categories = ['footwork', 'technique', 'moveintothrow', 'strongthrow', 'intangibles'];
            return categories.reduce((sum, cat) => sum + (attempt[cat] || 0), 0);
        }

        function calculateGroundBallsAverage(groundballs) {
            if (!groundballs || !Array.isArray(groundballs)) return 0;
            const totals = groundballs.map(attempt => calculateGroundBallAttemptTotal(attempt));
            const validTotals = totals.filter(t => t > 0);
            if (validTotals.length === 0) return 0;
            return validTotals.reduce((sum, t) => sum + t, 0) / validTotals.length;
        }

        function calculateFlyBallTotal(flyball) {
            if (!flyball) return 0;
            const categories = ['footwork', 'technique', 'moveintothrow', 'strongthrow', 'intangibles'];
            return categories.reduce((sum, cat) => sum + (flyball[cat] || 0), 0);
        }

        function calculateFlyBallTagupTotal(flyballtagup) {
            if (!flyballtagup) return 0;
            const categories = ['footwork', 'technique', 'moveintothrow', 'strongthrow', 'intangibles'];
            return categories.reduce((sum, cat) => sum + (flyballtagup[cat] || 0), 0);
        }

        function calculateVelocityScore(velocity) {
            if (velocity === null || velocity === undefined || velocity === '') return 0;
            const v = parseFloat(velocity);
            if (isNaN(v)) return 0;
            if (v >= 63) return 5;
            if (v >= 59) return 4;
            if (v >= 53) return 3;
            if (v >= 48) return 2;
            return 1;
        }

        function calculateFieldingTotal(player) {
            const f = player.fielding || {};
            const groundBallsAvg = calculateGroundBallsAverage(f.groundballs || []);
            const flyBallTotal = calculateFlyBallTotal(f.flyball);
            return groundBallsAvg + flyBallTotal;
        }

        function calculateThrowingTotal(player) {
            const t = player.throwing || {};
            const velocityScore = calculateVelocityScore(t.velocity);
            const flyBallTagupTotal = calculateFlyBallTagupTotal(t.flyballtagup);
            return velocityScore + flyBallTagupTotal;
        }

        // ============================================
        // CALCULATION FUNCTIONS
        // ============================================
        function getBestTime(times) {
            const valid = times.filter(t => t !== null && !isNaN(t));
            if (valid.length === 0) return null;
            return Math.min(...valid).toFixed(2);
        }

        function getAverageTime(times) {
            const valid = times.filter(t => t !== null && !isNaN(t));
            if (valid.length === 0) return null;
            const avg = valid.reduce((sum, t) => sum + t, 0) / valid.length;
            return avg.toFixed(2);
        }

        function getBestDistance(distances) {
            const valid = distances.filter(d => d !== null && !isNaN(d));
            if (valid.length === 0) return null;
            return Math.max(...valid).toFixed(1);
        }

        function getAdjustedBestH1B(data) {
            let best = null;
            for (let i = 0; i < 2; i++) {
                if (data.times[i] !== null) {
                    let adjusted = data.times[i] + (data.missed1b[i] ? 0.5 : 0);
                    if (best === null || adjusted < best) best = adjusted;
                }
            }
            return best ? best.toFixed(2) : 'N/A';
        }

        function getAdjustedAvgH1B(data) {
            const adjusted = [];
            for (let i = 0; i < 2; i++) {
                if (data.times[i] !== null) {
                    adjusted.push(data.times[i] + (data.missed1b[i] ? 0.5 : 0));
                }
            }
            if (adjusted.length === 0) return 'N/A';
            const avg = adjusted.reduce((sum, t) => sum + t, 0) / adjusted.length;
            return avg.toFixed(2);
        }

        function getAdjustedBest2BH(data) {
            let best = null;
            for (let i = 0; i < 2; i++) {
                if (data.times[i] !== null) {
                    let adjusted = data.times[i] + (data.missed3b[i] ? 1 : 0);
                    if (best === null || adjusted < best) best = adjusted;
                }
            }
            return best ? best.toFixed(2) : 'N/A';
        }

        function getAdjustedAvg2BH(data) {
            const adjusted = [];
            for (let i = 0; i < 2; i++) {
                if (data.times[i] !== null) {
                    adjusted.push(data.times[i] + (data.missed3b[i] ? 1 : 0));
                }
            }
            if (adjusted.length === 0) return 'N/A';
            const avg = adjusted.reduce((sum, t) => sum + t, 0) / adjusted.length;
            return avg.toFixed(2);
        }

        function calculateSpeedScore(drill, time) {
            if (time === 'N/A' || time === null) return 0;
            const t = parseFloat(time);
            const config = scoringConfig[drill];
            if (!config) return 0;

            // For time-based drills, lower is better
            // Using <= so hitting the threshold exactly gives the higher score
            if (t <= config.t5) return 5;
            if (t <= config.t4) return 4;
            if (t <= config.t3) return 3;
            if (t <= config.t2) return 2;
            return 1;
        }

        function calculatePopTimeScore(times) {
            const avg = getAverageTime(times);
            if (!avg) return 0;
            return calculateSpeedScore('poptime', avg);
        }

        function calculateProAgilityScore(times) {
            const avg = getAverageTime(times);
            if (!avg) return 0;
            const t = parseFloat(avg);
            const cfg = scoringConfig.proagility;
            // Using <= so hitting the threshold exactly gives the higher score
            if (t <= cfg.t5) return 5;
            if (t <= cfg.t4) return 4;
            if (t <= cfg.t3) return 3;
            if (t <= cfg.t2) return 2;
            return 1;
        }

        function getBestBroadJump(jumps) {
            if (!jumps || !Array.isArray(jumps)) return null;
            let bestTotal = null;
            let bestFeet = null;
            let bestInches = null;

            jumps.forEach(jump => {
                if (jump && typeof jump === 'object' && jump.feet !== null) {
                    const totalInches = (jump.feet * 12) + (jump.inches || 0);
                    if (bestTotal === null || totalInches > bestTotal) {
                        bestTotal = totalInches;
                        bestFeet = jump.feet;
                        bestInches = jump.inches || 0;
                    }
                } else if (typeof jump === 'number') {
                    // Handle legacy format (just feet as decimal)
                    const totalInches = jump * 12;
                    if (bestTotal === null || totalInches > bestTotal) {
                        bestTotal = totalInches;
                        bestFeet = Math.floor(jump);
                        bestInches = Math.round((jump - Math.floor(jump)) * 12);
                    }
                }
            });

            if (bestTotal === null) return null;
            return `${bestFeet}' ${bestInches}"`;
        }

        function getBroadJumpInFeet(jumps) {
            if (!jumps || !Array.isArray(jumps)) return null;
            let best = null;

            jumps.forEach(jump => {
                if (jump && typeof jump === 'object' && jump.feet !== null) {
                    const totalFeet = jump.feet + ((jump.inches || 0) / 12);
                    if (best === null || totalFeet > best) {
                        best = totalFeet;
                    }
                } else if (typeof jump === 'number') {
                    // Handle legacy format
                    if (best === null || jump > best) {
                        best = jump;
                    }
                }
            });

            return best;
        }

        function getAverageBroadJumpInFeet(jumps) {
            if (!jumps || !Array.isArray(jumps)) return null;
            const valid = [];

            jumps.forEach(jump => {
                if (jump && typeof jump === 'object' && jump.feet !== null) {
                    valid.push(jump.feet + ((jump.inches || 0) / 12));
                } else if (typeof jump === 'number') {
                    valid.push(jump);
                }
            });

            if (valid.length === 0) return null;
            return valid.reduce((sum, v) => sum + v, 0) / valid.length;
        }

        function getAverageBroadJump(jumps) {
            const avgFeet = getAverageBroadJumpInFeet(jumps);
            if (avgFeet === null) return null;
            const feet = Math.floor(avgFeet);
            const inches = Math.round((avgFeet - feet) * 12);
            return `${feet}' ${inches}"`;
        }

        function calculateBroadJumpScore(jumps) {
            const avg = getAverageBroadJumpInFeet(jumps);
            if (!avg) return 0;
            const d = avg;
            const config = scoringConfig.broadjump;

            // Helper to convert threshold to feet (handles both old number format and new {feet, inches} format)
            const toFeet = (val) => {
                if (typeof val === 'object' && val !== null) {
                    return (val.feet || 0) + ((val.inches || 0) / 12);
                }
                return val || 0;
            };

            // For broad jump, higher is better
            // Using >= so hitting the threshold exactly gives the higher score
            if (d >= toFeet(config.t5)) return 5;
            if (d >= toFeet(config.t4)) return 4;
            if (d >= toFeet(config.t3)) return 3;
            if (d >= toFeet(config.t2)) return 2;
            return 1;
        }

        function sumScores(arr) {
            return arr.filter(v => v !== null && !isNaN(v)).reduce((sum, v) => sum + parseInt(v), 0);
        }

        function calculateAverageScore(coachScores, drillId) {
            const scores = [];
            Object.values(coachScores).forEach(coach => {
                if (coach[drillId] !== undefined && coach[drillId] !== null) {
                    scores.push(coach[drillId]);
                }
            });
            if (scores.length === 0) return 0;
            return scores.reduce((sum, s) => sum + s, 0) / scores.length;
        }

        function countCoachScores(coachScores, drillId) {
            let count = 0;
            Object.values(coachScores).forEach(coach => {
                if (coach[drillId] !== undefined && coach[drillId] !== null) count++;
            });
            return count;
        }

        function calculateCatchingTotal(player) {
            const c = player.catching || {};
            let total = 0;
            total += calculatePopTimeScore(c.poptime || []);
            total += sumScores(c.throwaccuracy || []);
            total += c.blocking || 0;
            total += c.footwork || 0;
            total += c.mobility || 0;
            total += c.explosiveness_throwing || 0;
            total += c.explosiveness_bunts || 0;
            return total;
        }

        function calculateBaserunningTotal(player) {
            const b = player.baserunning || {};
            let total = 0;

            // Speed metrics (10 points max) - using averages
            total += calculateSpeedScore('h1b', getAdjustedAvgH1B(b.h1b || { times: [null, null], missed1b: [false, false] }));
            total += calculateSpeedScore('2bh', getAdjustedAvg2BH(b['2bh'] || { times: [null, null], missed3b: [false, false] }));

            // Explosiveness (10 points max)
            total += calculateProAgilityScore(b.proagility || []);
            total += calculateBroadJumpScore(b.broadjump || []);

            // Scrimmage (10 points max averaged)
            const scrimmage = b.scrimmage || {};
            const scrimmgeDrills = ['runningform', 'intangibles'];
            scrimmgeDrills.forEach(drill => {
                total += calculateAverageScore(scrimmage, drill);
            });

            return Math.round(total * 10) / 10;
        }

        function calculateIntangiblesTotal(player) {
            const intangibles = player.intangibles || {};
            const drills = ['awareness', 'leadership', 'enthusiasm'];
            let total = 0;
            drills.forEach(drill => {
                total += calculateAverageScore(intangibles, drill);
            });
            return total;
        }

        // ============================================
        // REPORT GENERATION
        // ============================================
        function showReportModal() {
            const modal = document.getElementById('reportModal');
            const select = document.getElementById('reportPlayerSelect');

            // Populate player dropdown
            select.innerHTML = '<option value="">-- Choose a player --</option>' +
                players.map(p => `<option value="${p.id}">${p.name} (#${p.number || 'N/A'})</option>`).join('');

            modal.classList.remove('hidden');
        }

        function closeReportModal() {
            document.getElementById('reportModal').classList.add('hidden');
        }

        // ============================================
        // USER GUIDE FUNCTIONS
        // ============================================
        function showUserGuideModal() {
            const modal = document.getElementById('userGuideModal');
            const content = document.getElementById('userGuideContent');
            content.innerHTML = getUserGuideHTML();
            modal.classList.remove('hidden');
        }

        function closeUserGuideModal() {
            document.getElementById('userGuideModal').classList.add('hidden');
        }

        function getUserGuideHTML() {
            // Get current thresholds for display
            const cfg = scoringConfig;
            const bj = cfg.broadjump;
            const formatBJ = (t) => `${t.feet}'${t.inches}"`;

            return `
                <style>
                    .guide-section { margin-bottom: 24px; }
                    .guide-section h2 { color: #1e40af; border-bottom: 2px solid #3b82f6; padding-bottom: 8px; margin-bottom: 16px; }
                    .guide-section h3 { color: #1e3a8a; margin-top: 16px; margin-bottom: 8px; }
                    .guide-table { width: 100%; border-collapse: collapse; margin: 12px 0; }
                    .guide-table th, .guide-table td { padding: 8px 12px; text-align: left; border: 1px solid #e5e7eb; }
                    .guide-table th { background: #f3f4f6; font-weight: 600; }
                    .guide-table tr:nth-child(even) { background: #f9fafb; }
                    .threshold-table { font-size: 0.9em; }
                    .threshold-table td { text-align: center; }
                    .note-box { background: #fef3c7; border-left: 4px solid #f59e0b; padding: 12px; margin: 12px 0; }
                    .tip-box { background: #dbeafe; border-left: 4px solid #3b82f6; padding: 12px; margin: 12px 0; }
                </style>

                <div class="guide-section">
                    <h2>üìã Getting Started</h2>
                    <h3>Logging In</h3>
                    <ol>
                        <li>Open the application in your web browser</li>
                        <li>Select your name from the dropdown</li>
                        <li>Enter the password: <code>nick2026</code></li>
                        <li>Click "Login"</li>
                    </ol>
                    <p>Your login stays active until you log out or clear your browser data.</p>
                </div>

                <div class="guide-section">
                    <h2>‚ûï Adding Players</h2>
                    <ol>
                        <li>Click the <strong>"Options"</strong> button at the top</li>
                        <li>Enter the player's name and jersey number</li>
                        <li>Click "Add Player" - the player will appear in the list</li>
                    </ol>
                </div>

                <div class="guide-section">
                    <h2>üìä Scoring Players</h2>
                    <p>Click on any player's name to expand their scoring sections.</p>

                    <h3>Catching (29 points max)</h3>
                    <table class="guide-table">
                        <tr><th>Metric</th><th>How to Score</th></tr>
                        <tr><td><strong>Pop Time</strong></td><td>Enter time in seconds for 2 attempts. Average is scored 1-5.</td></tr>
                        <tr><td><strong>Throw Accuracy</strong></td><td>Score each of 3 throws from 0-3 (0=miss, 3=perfect)</td></tr>
                        <tr><td><strong>Blocking</strong></td><td>Score 0-3</td></tr>
                        <tr><td><strong>Footwork</strong></td><td>Score 0-3</td></tr>
                        <tr><td><strong>Mobility</strong></td><td>Score 0-3</td></tr>
                        <tr><td><strong>Explosiveness (Throwing)</strong></td><td>Score 0-3</td></tr>
                        <tr><td><strong>Explosiveness (Bunts)</strong></td><td>Score 0-3</td></tr>
                    </table>

                    <h3>Baserunning (45 points max)</h3>
                    <p><strong>Timed Runs</strong> (scored 1-5 based on average time):</p>
                    <table class="guide-table">
                        <tr><th>Run</th><th>Attempts</th><th>Penalty Checkbox</th></tr>
                        <tr><td><strong>H‚Üí1B</strong></td><td>2</td><td>"Missed 1B" adds 0.5 seconds</td></tr>
                        <tr><td><strong>2B‚ÜíH</strong></td><td>2</td><td>"Missed 3B" adds 1 second</td></tr>
                        <tr><td><strong>H‚Üí3B</strong></td><td>1</td><td>"No Stick" adds 1 second</td></tr>
                        <tr><td><strong>H‚ÜíH</strong></td><td>1</td><td>"Missed Base" adds 1 second</td></tr>
                    </table>

                    <p><strong>Explosiveness:</strong></p>
                    <table class="guide-table">
                        <tr><th>Metric</th><th>How to Enter</th></tr>
                        <tr><td><strong>Pro Agility</strong></td><td>Enter time in seconds for 2 attempts (scored on average)</td></tr>
                        <tr><td><strong>Broad Jump</strong></td><td>Enter feet and inches for 2 attempts (scored on average)</td></tr>
                    </table>

                    <p><strong>Scrimmage Scores</strong> (each coach enters their own 1-3 scores):</p>
                    <ul>
                        <li>Chop Step</li>
                        <li>Rounding</li>
                        <li>Sliding</li>
                        <li>Softball IQ</li>
                        <li>Aggressiveness</li>
                    </ul>

                    <h3>Intangibles (15 points max)</h3>
                    <p>Each coach enters their own 1-5 scores:</p>
                    <ul>
                        <li>Game Situation Awareness</li>
                        <li>Leadership</li>
                        <li>Enthusiasm</li>
                    </ul>
                    <p><em>Intangibles are averaged across all coaches who scored the player.</em></p>
                </div>

                <div class="guide-section">
                    <h2>üìù Adding Notes</h2>
                    <p>Each category has a <strong>Notes</strong> section at the bottom.</p>
                    <ol>
                        <li>Type your note in the text box</li>
                        <li>Click <strong>"Add Note"</strong></li>
                        <li>Your name and timestamp are automatically recorded</li>
                    </ol>
                    <div class="note-box">
                        <strong>Note:</strong> You can only delete notes that you created.
                    </div>
                </div>

                <div class="guide-section">
                    <h2>üìà Generating Reports</h2>
                    <ol>
                        <li>Click <strong>"Options"</strong> then <strong>"Generate Reports"</strong></li>
                        <li>Choose:
                            <ul>
                                <li><strong>Individual Player:</strong> Select from dropdown</li>
                                <li><strong>All Players:</strong> Click "Generate All Reports" for ranked summary</li>
                            </ul>
                        </li>
                        <li>Click <strong>"Export Report"</strong> to download as HTML</li>
                    </ol>
                </div>

                <div class="guide-section">
                    <h2>‚öôÔ∏è Scoring Thresholds</h2>
                    <p>Current thresholds (can be customized via "Scoring Thresholds" button):</p>

                    <h3>Time-Based Drills (lower is better)</h3>
                    <table class="guide-table threshold-table">
                        <tr><th>Drill</th><th>5 pts</th><th>4 pts</th><th>3 pts</th><th>2 pts</th><th>1 pt</th></tr>
                        <tr><td><strong>Pop Time</strong></td><td>‚â§${cfg.poptime.t5}s</td><td>‚â§${cfg.poptime.t4}s</td><td>‚â§${cfg.poptime.t3}s</td><td>‚â§${cfg.poptime.t2}s</td><td>>${cfg.poptime.t2}s</td></tr>
                        <tr><td><strong>H‚Üí1B</strong></td><td>‚â§${cfg.h1b.t5}s</td><td>‚â§${cfg.h1b.t4}s</td><td>‚â§${cfg.h1b.t3}s</td><td>‚â§${cfg.h1b.t2}s</td><td>>${cfg.h1b.t2}s</td></tr>
                        <tr><td><strong>2B‚ÜíH</strong></td><td>‚â§${cfg['2bh'].t5}s</td><td>‚â§${cfg['2bh'].t4}s</td><td>‚â§${cfg['2bh'].t3}s</td><td>‚â§${cfg['2bh'].t2}s</td><td>>${cfg['2bh'].t2}s</td></tr>
                        <tr><td><strong>Pro Agility</strong></td><td>‚â§${cfg.proagility.t5}s</td><td>‚â§${cfg.proagility.t4}s</td><td>‚â§${cfg.proagility.t3}s</td><td>‚â§${cfg.proagility.t2}s</td><td>>${cfg.proagility.t2}s</td></tr>
                    </table>

                    <h3>Broad Jump (higher is better)</h3>
                    <table class="guide-table threshold-table">
                        <tr><th>5 pts</th><th>4 pts</th><th>3 pts</th><th>2 pts</th><th>1 pt</th></tr>
                        <tr><td>‚â•${formatBJ(bj.t5)}</td><td>‚â•${formatBJ(bj.t4)}</td><td>‚â•${formatBJ(bj.t3)}</td><td>‚â•${formatBJ(bj.t2)}</td><td><${formatBJ(bj.t2)}</td></tr>
                    </table>
                </div>

                <div class="guide-section">
                    <h2>üîÑ Data Syncing</h2>
                    <ul>
                        <li>All scores <strong>automatically save</strong> to Google Sheets</li>
                        <li>Changes sync within 1 second of entering data</li>
                        <li>You'll see the last sync time at the top of the screen</li>
                        <li>Multiple coaches can score simultaneously - data merges automatically</li>
                    </ul>
                </div>

                <div class="guide-section">
                    <h2>üí° Tips</h2>
                    <div class="tip-box">
                        <ol>
                            <li><strong>Score as you go</strong> - Don't wait until the end; data saves automatically</li>
                            <li><strong>Use notes</strong> for observations that don't fit in scores (attitude, coachability, etc.)</li>
                            <li><strong>Check the sync indicator</strong> to make sure your data is saving</li>
                            <li><strong>Generate reports</strong> at the end of tryouts to review all players ranked by score</li>
                        </ol>
                    </div>
                </div>

                <div class="guide-section">
                    <h2>‚ùì Troubleshooting</h2>
                    <table class="guide-table">
                        <tr><th>Problem</th><th>Solution</th></tr>
                        <tr><td>Can't log in</td><td>Make sure password is exactly <code>nick2026</code></td></tr>
                        <tr><td>Data not saving</td><td>Check your internet connection; look for sync indicator</td></tr>
                        <tr><td>Can't see other coaches' scores</td><td>Refresh the page to pull latest data</td></tr>
                        <tr><td>Report shows "N/A"</td><td>That metric hasn't been scored yet</td></tr>
                    </table>
                </div>

                <div class="guide-section">
                    <h2>üìû Questions?</h2>
                    <p>Contact Nick for technical support.</p>
                </div>
            `;
        }

        function exportUserGuideHTML() {
            const guideHTML = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GC Softball Tryouts 2026 - Coach User Guide</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.6; }
        h1 { color: #d97706; border-bottom: 3px solid #d97706; padding-bottom: 10px; }
        h2 { color: #1e40af; border-bottom: 2px solid #3b82f6; padding-bottom: 8px; margin-top: 30px; }
        h3 { color: #1e3a8a; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th, td { padding: 10px; text-align: left; border: 1px solid #e5e7eb; }
        th { background: #f3f4f6; font-weight: 600; }
        tr:nth-child(even) { background: #f9fafb; }
        code { background: #f3f4f6; padding: 2px 6px; border-radius: 4px; font-family: monospace; }
        .note-box { background: #fef3c7; border-left: 4px solid #f59e0b; padding: 12px; margin: 15px 0; }
        .tip-box { background: #dbeafe; border-left: 4px solid #3b82f6; padding: 12px; margin: 15px 0; }
        ul, ol { margin: 10px 0; padding-left: 25px; }
        li { margin: 5px 0; }
        @media print { body { max-width: 100%; } }
    </style>
</head>
<body>
    <h1>üìñ GC Softball Tryouts 2026 - Coach User Guide</h1>
    ${document.getElementById('userGuideContent').innerHTML}
    <hr>
    <p style="text-align: center; color: #6b7280; font-size: 0.9em;">
        Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
    </p>
</body>
</html>`;

            const blob = new Blob([guideHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'GC_Softball_Tryouts_User_Guide.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function printUserGuide() {
            const content = document.getElementById('userGuideContent').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
<!DOCTYPE html>
<html>
<head>
    <title>GC Softball Tryouts - Coach User Guide</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.6; }
        h1 { color: #d97706; border-bottom: 3px solid #d97706; padding-bottom: 10px; }
        h2 { color: #1e40af; border-bottom: 2px solid #3b82f6; padding-bottom: 8px; margin-top: 30px; }
        h3 { color: #1e3a8a; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th, td { padding: 10px; text-align: left; border: 1px solid #ccc; }
        th { background: #f3f4f6; }
        code { background: #f3f4f6; padding: 2px 6px; border-radius: 4px; }
        .note-box { background: #fef3c7; border-left: 4px solid #f59e0b; padding: 12px; margin: 15px 0; }
        .tip-box { background: #dbeafe; border-left: 4px solid #3b82f6; padding: 12px; margin: 15px 0; }
    </style>
</head>
<body>
    <h1>üìñ GC Softball Tryouts 2026 - Coach User Guide</h1>
    ${content}
</body>
</html>`);
            printWindow.document.close();
            printWindow.print();
        }

        function generateReport() {
            const playerId = parseInt(document.getElementById('reportPlayerSelect').value);
            if (!playerId) {
                document.getElementById('reportContent').innerHTML =
                    '<p class="text-gray-500 text-center">Select a player to generate their summary report</p>';
                return;
            }

            const player = players.find(p => p.id === playerId);
            if (!player) return;

            document.getElementById('reportContent').innerHTML = generatePlayerReportHTML(player);
        }

        function generateAllReports() {
            if (players.length === 0) {
                document.getElementById('reportContent').innerHTML =
                    '<p class="text-gray-500 text-center">No players to generate reports for</p>';
                return;
            }

            const sortedPlayers = [...players].sort((a, b) => {
                const totalA = calculateCatchingTotal(a) + calculateBaserunningTotal(a) + calculateIntangiblesTotal(a) + calculateFieldingTotal(a) + calculateThrowingTotal(a);
                const totalB = calculateCatchingTotal(b) + calculateBaserunningTotal(b) + calculateIntangiblesTotal(b) + calculateFieldingTotal(b) + calculateThrowingTotal(b);
                return totalB - totalA;
            });

            document.getElementById('reportContent').innerHTML = sortedPlayers.map((player, idx) =>
                `<div class="mb-8 ${idx > 0 ? 'border-t-4 border-gray-300 pt-8' : ''}">${generatePlayerReportHTML(player, idx + 1)}</div>`
            ).join('');
        }

        function generatePlayerReportHTML(player, rank = null) {
            const c = player.catching || {};
            const b = player.baserunning || {};
            const intang = player.intangibles || {};
            const f = player.fielding || {};
            const t = player.throwing || {};

            const catchingTotal = calculateCatchingTotal(player);
            const baserunningTotal = calculateBaserunningTotal(player);
            const intangiblesTotal = calculateIntangiblesTotal(player);
            const fieldingTotal = calculateFieldingTotal(player);
            const throwingTotal = calculateThrowingTotal(player);
            const grandTotal = catchingTotal + baserunningTotal + intangiblesTotal + fieldingTotal + throwingTotal;

            // Get all notes
            const catchingNotes = c.notes || [];
            const baserunningNotes = b.notes || [];
            const intangiblesNotes = intang.notes || [];
            const fieldingNotes = f.notes || [];
            const throwingNotes = t.notes || [];

            return `
                <div class="report-player border-2 border-gray-200 rounded-lg p-6 bg-white print:break-inside-avoid">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800">${player.name}</h3>
                            <p class="text-gray-600">Jersey #${player.number || 'N/A'}</p>
                        </div>
                        <div class="text-right">
                            ${rank ? `<div class="text-lg font-semibold text-indigo-600">Rank #${rank}</div>` : ''}
                            <div class="text-3xl font-bold text-green-600">${grandTotal.toFixed(1)}</div>
                            <div class="text-sm text-gray-500">Total Points</div>
                        </div>
                    </div>

                    <!-- Score Summary Bar -->
                    <div class="grid grid-cols-5 gap-2 mb-6">
                        <div class="bg-purple-100 p-3 rounded-lg text-center">
                            <div class="text-xl font-bold text-purple-700">${catchingTotal}</div>
                            <div class="text-xs text-purple-600">Catching</div>
                        </div>
                        <div class="bg-blue-100 p-3 rounded-lg text-center">
                            <div class="text-xl font-bold text-blue-700">${baserunningTotal.toFixed(1)}</div>
                            <div class="text-xs text-blue-600">Baserunning</div>
                        </div>
                        <div class="bg-green-100 p-3 rounded-lg text-center">
                            <div class="text-xl font-bold text-green-700">${fieldingTotal.toFixed(1)}</div>
                            <div class="text-xs text-green-600">Fielding</div>
                        </div>
                        <div class="bg-red-100 p-3 rounded-lg text-center">
                            <div class="text-xl font-bold text-red-700">${throwingTotal.toFixed(1)}</div>
                            <div class="text-xs text-red-600">Throwing</div>
                        </div>
                        <div class="bg-yellow-100 p-3 rounded-lg text-center">
                            <div class="text-xl font-bold text-yellow-700">${intangiblesTotal.toFixed(1)}</div>
                            <div class="text-xs text-yellow-600">Intangibles</div>
                        </div>
                    </div>

                    <!-- Catching Details -->
                    <div class="mb-4">
                        <h4 class="font-semibold text-purple-700 border-b border-purple-200 pb-1 mb-2">Catching Details</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-sm">
                            <div><span class="text-gray-500">Pop Time (Avg):</span> ${getAverageTime(c.poptime || []) || 'N/A'}s (${calculatePopTimeScore(c.poptime || [])}/5)</div>
                            <div><span class="text-gray-500">Throw Accuracy:</span> ${sumScores(c.throwaccuracy || [])}/9</div>
                            <div><span class="text-gray-500">Blocking:</span> ${c.blocking ?? 'N/A'}/3</div>
                            <div><span class="text-gray-500">Footwork:</span> ${c.footwork ?? 'N/A'}/3</div>
                            <div><span class="text-gray-500">Mobility:</span> ${c.mobility ?? 'N/A'}/3</div>
                            <div><span class="text-gray-500">Expl. Throwing:</span> ${c.explosiveness_throwing ?? 'N/A'}/3</div>
                            <div><span class="text-gray-500">Expl. Bunts:</span> ${c.explosiveness_bunts ?? 'N/A'}/3</div>
                        </div>
                        ${catchingNotes.length > 0 ? `
                            <div class="mt-2 p-2 bg-purple-50 rounded text-sm">
                                <strong>Notes:</strong>
                                ${catchingNotes.map(n => `<div class="ml-2"><em>${n.coach}:</em> ${n.text}</div>`).join('')}
                            </div>
                        ` : ''}
                    </div>

                    <!-- Baserunning Details -->
                    <div class="mb-4">
                        <h4 class="font-semibold text-blue-700 border-b border-blue-200 pb-1 mb-2">Baserunning Details</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-sm">
                            <div><span class="text-gray-500">H‚Üí1B (Avg):</span> ${getAdjustedAvgH1B(b.h1b || { times: [null, null], missed1b: [false, false] }) || 'N/A'}s (${calculateSpeedScore('h1b', getAdjustedAvgH1B(b.h1b || { times: [null, null], missed1b: [false, false] }))}/5)</div>
                            <div><span class="text-gray-500">2B‚ÜíH (Avg):</span> ${getAdjustedAvg2BH(b['2bh'] || { times: [null, null], missed3b: [false, false] }) || 'N/A'}s (${calculateSpeedScore('2bh', getAdjustedAvg2BH(b['2bh'] || { times: [null, null], missed3b: [false, false] }))}/5)</div>
                            <div><span class="text-gray-500">Pro Agility (Avg):</span> ${getAverageTime(b.proagility || []) || 'N/A'}s (${calculateProAgilityScore(b.proagility || [])}/5)</div>
                            <div><span class="text-gray-500">Broad Jump (Avg):</span> ${getAverageBroadJump(b.broadjump || []) || 'N/A'} (${calculateBroadJumpScore(b.broadjump || [])}/5)</div>
                        </div>
                        <div class="mt-2 text-sm">
                            <span class="text-gray-500">Scrimmage Scores (Avg):</span>
                            Running Form: ${calculateAverageScore(b.scrimmage || {}, 'runningform').toFixed(1)} |
                            Intangibles: ${calculateAverageScore(b.scrimmage || {}, 'intangibles').toFixed(1)}
                        </div>
                        ${baserunningNotes.length > 0 ? `
                            <div class="mt-2 p-2 bg-blue-50 rounded text-sm">
                                <strong>Notes:</strong>
                                ${baserunningNotes.map(n => `<div class="ml-2"><em>${n.coach}:</em> ${n.text}</div>`).join('')}
                            </div>
                        ` : ''}
                    </div>

                    <!-- Fielding Details -->
                    <div class="mb-4">
                        <h4 class="font-semibold text-green-700 border-b border-green-200 pb-1 mb-2">Fielding Details</h4>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div><span class="text-gray-500">Ground Balls (Avg):</span> ${calculateGroundBallsAverage(f.groundballs || []).toFixed(1)}/25</div>
                            <div><span class="text-gray-500">Fly Ball:</span> ${calculateFlyBallTotal(f.flyball)}/25</div>
                        </div>
                        ${fieldingNotes.length > 0 ? `
                            <div class="mt-2 p-2 bg-green-50 rounded text-sm">
                                <strong>Notes:</strong>
                                ${fieldingNotes.map(n => `<div class="ml-2"><em>${n.coach}:</em> ${n.text}</div>`).join('')}
                            </div>
                        ` : ''}
                    </div>

                    <!-- Throwing Details -->
                    <div class="mb-4">
                        <h4 class="font-semibold text-red-700 border-b border-red-200 pb-1 mb-2">Throwing Details</h4>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div><span class="text-gray-500">Velocity:</span> ${t.velocity || 'N/A'} mph (${calculateVelocityScore(t.velocity)}/5)</div>
                            <div><span class="text-gray-500">Fly Ball Tagup:</span> ${calculateFlyBallTagupTotal(t.flyballtagup)}/25</div>
                        </div>
                        ${throwingNotes.length > 0 ? `
                            <div class="mt-2 p-2 bg-red-50 rounded text-sm">
                                <strong>Notes:</strong>
                                ${throwingNotes.map(n => `<div class="ml-2"><em>${n.coach}:</em> ${n.text}</div>`).join('')}
                            </div>
                        ` : ''}
                    </div>

                    <!-- Intangibles Details -->
                    <div class="mb-4">
                        <h4 class="font-semibold text-yellow-700 border-b border-yellow-200 pb-1 mb-2">Intangibles Details</h4>
                        <div class="grid grid-cols-3 gap-2 text-sm">
                            <div><span class="text-gray-500">Awareness:</span> ${calculateAverageScore(intang, 'awareness').toFixed(1)}/5</div>
                            <div><span class="text-gray-500">Leadership:</span> ${calculateAverageScore(intang, 'leadership').toFixed(1)}/5</div>
                            <div><span class="text-gray-500">Enthusiasm:</span> ${calculateAverageScore(intang, 'enthusiasm').toFixed(1)}/5</div>
                        </div>
                        ${intangiblesNotes.length > 0 ? `
                            <div class="mt-2 p-2 bg-yellow-50 rounded text-sm">
                                <strong>Notes:</strong>
                                ${intangiblesNotes.map(n => `<div class="ml-2"><em>${n.coach}:</em> ${n.text}</div>`).join('')}
                            </div>
                        ` : ''}
                    </div>

                    <div class="text-xs text-gray-400 text-right mt-4">
                        Report generated: ${new Date().toLocaleString()}
                    </div>
                </div>
            `;
        }

        function exportCurrentReport() {
            const reportContent = document.getElementById('reportContent').innerHTML;
            if (!reportContent || reportContent.includes('Select a player')) {
                alert('Please generate a report first');
                return;
            }

            const html = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>GC Softball Tryouts Report</title>
    <script src="https://cdn.tailwindcss.com"><\/script>
    <style>
        @media print {
            .report-player { page-break-inside: avoid; }
        }
        body { font-family: system-ui, -apple-system, sans-serif; }
    </style>
</head>
<body class="p-8 bg-gray-100">
    <div class="max-w-4xl mx-auto">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">GC Softball Tryouts 2026</h1>
            <p class="text-gray-600">Player Summary Report</p>
            <p class="text-sm text-gray-500">Generated: ${new Date().toLocaleString()}</p>
        </div>
        <div class="space-y-6">
            ${reportContent}
        </div>
    </div>
</body>
</html>`;

            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `GC_Tryouts_Report_${new Date().toISOString().split('T')[0]}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // ============================================
        // ALL PLAYERS VIEW
        // ============================================
        function renderAllPlayers() {
            const list = document.getElementById('playersList');

            if (players.length === 0) {
                list.innerHTML = '<p class="text-gray-500 text-center py-8">No players added yet. Use the Options menu to add players.</p>';
                return;
            }

            const sortedPlayers = [...players].sort((a, b) => {
                const totalA = calculateCatchingTotal(a) + calculateBaserunningTotal(a) + calculateIntangiblesTotal(a) + calculateFieldingTotal(a) + calculateThrowingTotal(a);
                const totalB = calculateCatchingTotal(b) + calculateBaserunningTotal(b) + calculateIntangiblesTotal(b) + calculateFieldingTotal(b) + calculateThrowingTotal(b);
                return totalB - totalA;
            });

            list.innerHTML = `
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="px-3 py-2 text-left">Rank</th>
                                <th class="px-3 py-2 text-left">Name</th>
                                <th class="px-3 py-2 text-center">#</th>
                                <th class="px-3 py-2 text-center">Catching</th>
                                <th class="px-3 py-2 text-center">Baserunning</th>
                                <th class="px-3 py-2 text-center">Fielding</th>
                                <th class="px-3 py-2 text-center">Throwing</th>
                                <th class="px-3 py-2 text-center">Intangibles</th>
                                <th class="px-3 py-2 text-center">Total</th>
                                <th class="px-3 py-2 text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sortedPlayers.map((p, idx) => {
                                const catching = calculateCatchingTotal(p);
                                const baserunning = calculateBaserunningTotal(p);
                                const fielding = calculateFieldingTotal(p);
                                const throwing = calculateThrowingTotal(p);
                                const intangibles = calculateIntangiblesTotal(p);
                                const total = catching + baserunning + fielding + throwing + intangibles;
                                return `
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="px-3 py-2 font-bold">${idx + 1}</td>
                                        <td class="px-3 py-2">${p.name}</td>
                                        <td class="px-3 py-2 text-center">${p.number || '-'}</td>
                                        <td class="px-3 py-2 text-center">${catching}/30</td>
                                        <td class="px-3 py-2 text-center">${baserunning.toFixed(1)}/30</td>
                                        <td class="px-3 py-2 text-center">${fielding.toFixed(1)}/50</td>
                                        <td class="px-3 py-2 text-center">${throwing.toFixed(1)}/30</td>
                                        <td class="px-3 py-2 text-center">${intangibles.toFixed(1)}/15</td>
                                        <td class="px-3 py-2 text-center font-bold">${total.toFixed(1)}/155</td>
                                        <td class="px-3 py-2 text-center">
                                            <button onclick="deletePlayer(${p.id})" class="text-red-600 hover:text-red-800">üóëÔ∏è</button>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // ============================================
        // GOOGLE SHEETS SYNC
        // ============================================
        async function uploadToSheets() {
            if (GOOGLE_SCRIPT_URL.includes('YOUR_NEW')) {
                alert('Please configure your Google Apps Script URL first.');
                return;
            }

            if (isSyncing) return;
            isSyncing = true;
            showSaveStatus('‚è≥ Uploading to Google Sheets...');

            try {
                const formData = new FormData();
                formData.append('data', JSON.stringify(players));

                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (result.success) {
                    showSaveStatus('‚úì Uploaded to Google Sheets!');
                    alert(`Successfully uploaded ${players.length} player(s)!`);
                } else {
                    showSaveStatus('‚ö†Ô∏è Upload failed');
                    alert('Upload failed: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Upload error:', error);
                showSaveStatus('‚ö†Ô∏è Upload failed');
                alert('Error uploading: ' + error.message);
            } finally {
                isSyncing = false;
            }
        }

        async function autoUploadToSheets() {
            if (GOOGLE_SCRIPT_URL.includes('YOUR_NEW') || isSyncing) return;

            isSyncing = true;
            showSaveStatus('‚è≥ Auto-syncing...');

            try {
                const formData = new FormData();
                formData.append('data', JSON.stringify(players));

                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                showSaveStatus(result.success ? '‚úì Auto-synced' : '‚ö†Ô∏è Sync failed');
            } catch (error) {
                console.error('Auto-upload error:', error);
                showSaveStatus('‚ö†Ô∏è Sync failed');
            } finally {
                isSyncing = false;
            }
        }

        async function downloadFromSheets() {
            if (GOOGLE_SCRIPT_URL.includes('YOUR_NEW')) {
                alert('Please configure your Google Apps Script URL first.');
                return;
            }

            if (isSyncing) return;
            isSyncing = true;
            showSaveStatus('‚è≥ Downloading...');

            try {
                const response = await fetch(GOOGLE_SCRIPT_URL);
                const data = await response.json();

                if (Array.isArray(data) && data.length > 0) {
                    if (confirm(`Found ${data.length} player(s). Replace local data?`)) {
                        players = data;
                        saveData();
                        renderPlayerSelect();
                        renderAllPlayers();
                        renderScoringArea();
                        showSaveStatus('‚úì Downloaded!');
                        alert(`Downloaded ${players.length} player(s)!`);
                    }
                } else {
                    showSaveStatus('No data found');
                    alert('No player data found in Google Sheets.');
                }
            } catch (error) {
                console.error('Download error:', error);
                showSaveStatus('‚ö†Ô∏è Download failed');
                alert('Error downloading: ' + error.message);
            } finally {
                isSyncing = false;
            }
        }

        async function autoDownloadFromSheets() {
            if (GOOGLE_SCRIPT_URL.includes('YOUR_NEW')) {
                loadData();
                return;
            }

            try {
                showSaveStatus('‚è≥ Loading from Sheets...');
                const response = await fetch(GOOGLE_SCRIPT_URL);
                const data = await response.json();

                if (Array.isArray(data) && data.length > 0) {
                    players = data;
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(players));
                    showSaveStatus('‚úì Loaded from Sheets');
                } else {
                    loadData();
                    showSaveStatus('Using local data');
                }
            } catch (error) {
                console.error('Auto-download error:', error);
                loadData();
                showSaveStatus('‚ö†Ô∏è Using local data');
            }
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        function showSaveStatus(message) {
            const status = document.getElementById('saveStatus');
            status.textContent = message;
            setTimeout(() => {
                status.textContent = 'üîÑ Auto-syncing with Google Sheets';
            }, 3000);
        }

        function toggleSection(id) {
            document.getElementById(id).classList.toggle('hidden');
        }

        function exportData() {
            // Simple CSV export
            let csv = 'Name,Number,Catching,Baserunning,Fielding,Throwing,Intangibles,Total\n';
            players.forEach(p => {
                const catching = calculateCatchingTotal(p);
                const baserunning = calculateBaserunningTotal(p);
                const fielding = calculateFieldingTotal(p);
                const throwing = calculateThrowingTotal(p);
                const intangibles = calculateIntangiblesTotal(p);
                const total = catching + baserunning + fielding + throwing + intangibles;
                csv += `"${p.name}","${p.number || ''}",${catching},${baserunning.toFixed(1)},${fielding.toFixed(1)},${throwing.toFixed(1)},${intangibles.toFixed(1)},${total.toFixed(1)}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'gc_softball_tryouts.csv';
            a.click();
            URL.revokeObjectURL(url);
        }

        function clearAllData() {
            if (confirm('Are you sure you want to delete ALL player data? This cannot be undone.')) {
                players = [];
                selectedPlayerId = null;
                localStorage.removeItem(STORAGE_KEY);
                renderPlayerSelect();
                renderAllPlayers();
                renderScoringArea();
                showSaveStatus('Data cleared');
            }
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        window.addEventListener('DOMContentLoaded', () => {
            checkSession();
            selectCategory('catching');
        });
    </script>
</body>
</html>
